<!DOCTYPE html>
<html lang="th">

<head>
    <base target="_top">
    <!-- no cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- no cache -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART SCHOOL BANK</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/confirmDate/confirmDate.css">
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/material_red.css">
    <link
        href="https://cdn.datatables.net/v/bs5/dt-2.3.0/b-3.2.3/date-1.5.5/fh-4.0.1/r-3.0.4/sl-3.0.0/datatables.min.css"
        rel="stylesheet" integrity="sha384-pDoMXaoekHsQmb1L6aeyRL/WoJRQnDTYvUeWu4LbiTVT2Vhp2niYUKgdwBE/Tnl8"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link
        href="https://cdn.datatables.net/v/bs5/dt-2.3.0/b-3.2.3/date-1.5.5/fh-4.0.1/r-3.0.4/sl-3.0.0/datatables.min.css"
        rel="stylesheet" integrity="sha384-pDoMXaoekHsQmb1L6aeyRL/WoJRQnDTYvUeWu4LbiTVT2Vhp2niYUKgdwBE/Tnl8"
        crossorigin="anonymous">
    <style>
        * {
            font-family: 'Noto Sans Thai', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1565C0;
            /* Primary Blue - main brand color */
            --secondary-color: #42A5F5;
            /* Light Blue - complementary color */
            --accent-color: #BBDEFB;
            /* Very Light Blue - light accent */
            --dark-color: #0D47A1;
            /* Dark Blue - for depth */
            --light-color: #F5F9FF;
            /* Light Blue-tinted white - for backgrounds */
        }

        body {
            background-color: var(--light-color);
            color: #212529;
        }

        NProgress .bar {
            background: var(--accent-color);
        }

        .text-bank {
            color: var(--primary-color);
        }

        .bg-bank {
            background-color: var(--primary-color);
            color: white;
        }

        .bg-bank-light {
            background-color: var(--secondary-color);
            color: var(--dark-color);
        }

        .btn-bank {
            background-color: var(--primary-color);
            color: white;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-export-bank {
            background-color: var(--primary-color);
            color: white;
            border: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            padding: 8px 12px;
            margin-right: 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .btn-bank:hover {
            background-color: var(--dark-color);
            color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card {
            border-color: var(--secondary-color);
            border-radius: 15px;
            overflow: hidden;
        }

        .card-header {
            background-color: var(--primary-color);
            border-bottom: none;
            padding: 1rem 1.5rem;
        }

        .nav-tabs .nav-link {
            color: var(--accent-color);
            border: none;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: 8px 8px 0 0;
        }

        .nav-tabs .nav-link.active {
            background-color: transparent;
            color: white;
            border-bottom: 3px solid white;
        }

        .nav-tabs .nav-link:hover:not(.active) {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: transparent;
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(21, 101, 192, 0.25);
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* Logo styling */
        .logo-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .logo-image:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .navbar {
            background: linear-gradient(to right, var(--dark-color), var(--primary-color));
            padding: 0.75rem 1rem;
        }

        .navbar-brand {
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .select,
        #locale {
            width: 100%;
        }

        .like {
            margin-right: 10px;
        }

        /* Additional animation styles */
        .coin-shape {
            position: fixed;
            width: 20px;
            height: 20px;
            background-color: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            z-index: -1;
            animation: floatAnimation linear infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #D4AF37;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            font-family: serif;
            font-weight: bold;
            color: #D4AF37;
        }


        @keyframes floatAnimation {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 0.5;
            }

            90% {
                opacity: 0.7;
            }

            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        .img-grid-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 4px;
        }

        .img-grid-col {
            flex: 33.33%;
            max-width: 33.33%;
            padding: 0 8px;
        }

        .img-grid-col img {
            /* margin-top: 8px; */
            vertical-align: middle;
            width: 100%;
        }

        .btn-muted {
            background-color: var(--secondary-color) !important;
            color: var(--dark-color) !important;
        }

        /* Enhanced checkbox styling for better contrast */
        .select-cow,
        .select-all-cows {
            width: 18px;
            height: 18px;
            border: 2px solid var(--primary-color);
            border-radius: 3px !important;
            background-color: #fff;
            cursor: pointer;
            margin-right: 5px;
            vertical-align: middle;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .select-cow:checked,
        .select-all-cows:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .select-cow:focus,
        .select-all-cows:focus {
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.25);
            outline: none;
        }

        .dt-head-nowrap {
            white-space: nowrap;
        }

        .temp-readonly {
            background-color: var(--secondary-color) !important;
            color: var(--dark-color) !important;
            cursor: not-allowed;
            pointer-events: none;
        }
    </style>
</head>

<body class="bg-light">
    <nav class="navbar navbar-dark m-0 py-2 navbar-expand-md shadow-sm no-print">
        <div class="container-fluid" data-bs-theme="dark"> <a class="navbar-brand d-flex align-items-center"
                href="<?!= base_url() ?>">
                <img src="https://img2.pic.in.th/pic/bda990b9-b514-4e87-9f65-149b3c16a3bdxvdfv8.jpg"
                    alt="SMART SCHOOL BANK Logo" height="45"
                    class="d-inline-block align-text-top me-2 rounded-circle border border-2 border-light">
                <span class="fw-bold" style="color: var(--accent-color);">SMART SCHOOL BANK</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item" id="userInfoContainer" style="display: none;">
                        <span class="nav-link d-flex align-items-center text-light">
                            <i class="fa-solid fa-user me-2"></i>
                            <span id="currentUsername">Username</span>
                        </span>
                    </li>
                    <li class="nav-item" id="logoutBtnContainer" style="display: none;">
                        <button class="nav-link d-flex align-items-center" id="logoutBtn">
                            <i class="fa-solid fa-right-from-bracket"></i>&nbsp;<span id="logoutText"
                                style="display:none">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Login and Register Form Section -->
    <div class="container py-5" id="authContainer">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow-lg border-0 rounded-lg mt-3" data-aos="fade-up" data-aos-duration="1000">
                    <div class="card-header">
                        <ul class="nav nav-tabs card-header-tabs" id="authTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link <?= isRegister ? '': 'active'?>" id="login-tab"
                                    data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab"
                                    aria-controls="login" aria-selected="true">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link <?= isRegister ? 'active' : ''?>" id="register-tab"
                                    data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab"
                                    aria-controls="register" aria-selected="false">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body p-4">
                        <div class="tab-content" id="authTabsContent">
                            <!-- Login Form -->
                            <div class="tab-pane fade <?= isRegister ? '' : 'show active'?>" id="login" role="tabpanel"
                                aria-labelledby="login-tab">
                                <div class="text-center mb-4">
                                    <div class="logo-container">
                                        <img src="https://img2.pic.in.th/pic/bda990b9-b514-4e87-9f65-149b3c16a3bdxvdfv8.jpg"
                                            alt="SMART SCHOOL BANK Logo" class="logo-image">
                                    </div>
                                    <h4 class="text-bank fw-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Smart School Bank</h4>
                                    <p class="text-muted">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
                                </div>
                                <form id="loginForm">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="loginUsername" type="text"
                                            placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required />
                                        <label for="loginUsername">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                        <div class="invalid-feedback mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="loginPassword" type="password"
                                            placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required />
                                        <label for="loginPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                        <div class="invalid-feedback mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
                                    </div>
                                    <div class="d-flex align-items-center justify-content-center mt-4 mb-0">
                                        <button class="btn btn-bank fw-bold rounded-3" type="submit"
                                            style="min-width: 200px;">
                                            <i class="fa-solid fa-right-to-bracket me-2"></i>
                                            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                                        </button>
                                    </div>
                                </form>
                            </div>

                            <!-- Register Form -->
                            <div class="tab-pane fade <?= isRegister ? 'show active' : ''?>" id="register"
                                role="tabpanel" aria-labelledby="register-tab">
                                <div class="text-center mb-4">
                                    <div class="logo-container">
                                        <img src="https://img5.pic.in.th/file/secure-sv1/efa573c6-eec8-41c0-8ec6-81129a372e9a.jpg"
                                            alt="POKPA FARM Logo" class="logo-image">
                                    </div>
                                    <h4 class="text-bank fw-bold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h4>
                                    <p class="text-muted">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                                </div>
                                <form id="registerForm">
                                    <input hidden id="uid" value="<?!= uid ?>">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="fullname" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠"
                                            required />
                                        <label for="fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="phone" type="tel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå"
                                            required />
                                        <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="childname" type="text"
                                            placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô" required />
                                        <label for="childname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô</label>
                                        <div class="invalid-feedback mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô</div>
                                        <span class="text-info small">‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏ï‡∏£‡∏´‡∏•‡∏≤‡∏ô <span
                                                class="fw-bold">‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å</span></span>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <select class="form-control" id="registerRole" required>
                                            <option value="Parent">‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</option>
                                            <option value="Teacher">‡∏Ñ‡∏£‡∏π</option>
                                            <option value="Admin">‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</option>
                                        </select>
                                        <label for="registerRole">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                                        <div class="invalid-feedback mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
                                    </div>
                                    <div class="form-floating mb-3 d-none" id="classContainer">
                                        <input class="form-control" id="registerClass" type="text"
                                            placeholder="‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•" />
                                        <label for="class">‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•</label>
                                        <div class="invalid-feedback mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÅ‡∏•</div>
                                    </div>
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="username" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"
                                            required />
                                        <label for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                        <div class="invalid-feedback mt-2" id="invalid-username"></div>
                                        <div class="valid-feedback mt-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <div class="form-floating mb-3 mb-md-0">
                                                <input class="form-control" id="registerPassword" type="password"
                                                    placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required />
                                                <label for="registerPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                                <div class="invalid-feedback mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
                                                </div>
                                                <div class="valid-feedback mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input class="form-control" id="confirmPassword" type="password"
                                                    placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required />
                                                <label for="confirmPassword">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                                <div class="invalid-feedback mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</div>
                                                <div class="valid-feedback mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 mb-0">
                                        <div class="d-grid">
                                            <button class="btn btn-bank fw-bold rounded-3" type="submit"
                                                style="min-width: 200px;">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <main>
        <div class="container-fluid d-none" id="mainContainer">
            <div class="row justify-content-center">
                <div class="col-12">
                    <div class="card shadow-lg border-0 rounded-lg mt-3" data-aos="fade-up" data-aos-duration="1000">
                        <div class="card-header bg-bank text-light text-center">
                            <h4 class="fw-bold">Smart School Bank</h4>
                        </div>
                        <div class="card-body p-2">
                            <!-- <div class="table-responsive p-2">
                                <table class="table table-striped table-bordered" id="cowDataTable">
                                </table>
                            </div> -->
                            <div class="table-responsive p-2">
                                <table class="table table-striped table-hover table-bordered mt-3" style="width: 100%;"
                                    id="main-table">
                                    <thead></thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid d-none" id="loadingContainer">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 text-center mt-5">
                    <h4 class="text-bank fw-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h4>
                    <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                    <div class="spinner-border text-bank" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid d-none" id="errorContainer">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 text-center mt-5">
                    <h4 class="text-danger fw-bold">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
                    <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                    <button class="btn btn-bank" id="retryBtn">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                </div>
            </div>
        </div>
        <div class="container-fluid d-none" id="logoutContainer">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 text-center mt-5">
                    <h4 class="text-bank fw-bold">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</h4>
                    <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/l10n/th.js"></script>
     <script
        src="https://cdn.datatables.net/v/bs5/dt-2.3.0/b-3.2.3/date-1.5.5/fh-4.0.1/r-3.0.4/sl-3.0.0/datatables.min.js"
        integrity="sha384-NGgUUnjETvXZrx9vJMQOG/C654mzSDv63TrMt0zQmS1HW58fN4RdjorjyZqEMIZ9" crossorigin="anonymous">
        </script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/tanaikech/ResumableUploadForGoogleDrive_js@master/resumableupload_js.min.js">
        </script>
    <script>
        AOS.init();
        let Toast
        document.addEventListener("DOMContentLoaded", function () {
            NProgress.start();
            NProgress.inc();

            // Custom SweetAlert2 theme to match our color scheme
            Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                }
            });

            // Form submission handlers
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            // Add focus effect to forms
            // const formInputs = document.querySelectorAll('.form-control');
            // formInputs.forEach(input => {
            //     input.addEventListener('focus', function() {
            //         this.parentElement.classList.add('shadow-sm');
            //     });
            //     input.addEventListener('blur', function() {
            //         this.parentElement.classList.remove('shadow-sm');
            //     });
            // });

            if (loginForm) {
                loginForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    let formData = {
                        username: document.getElementById('loginUsername').value,
                        password: document.getElementById('loginPassword').value
                    }
                    $(this).find('button[type="submit"]').html('<span class="spinner-border spinner-border-sm me-2"></span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...').prop('disabled', true);
                    NProgress.start();
                    NProgress.inc();
                    google.script.run.withFailureHandler(e => console.log(e)).withSuccessHandler((res) => {
                        NProgress.done();
                        res = JSON.parse(res);
                        if (res.success) {
                            // Show success message
                            $('#loginForm').trigger('reset');
                            $('#loginForm').find('.form-control').removeClass('is-valid').removeClass('is-invalid');
                            $('#loginForm').find('button[type="submit"]').html('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö').prop('disabled', false);
                            initializeApp(res);
                            Swal.fire({
                                title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                                icon: 'success',
                                showConfirmButton: false,
                                background: 'var(--light-color)',
                                iconColor: 'var(--primary-color)',
                                timer: 2000,
                                timerProgressBar: true,
                                customClass: {
                                    popup: 'rounded-4'
                                }
                            })
                        } else {
                            // Show error message
                            $('#loginForm').find('button[type="submit"]').html('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö').prop('disabled', false);
                            $('#loginForm').find('.form-control').removeClass('is-valid').removeClass('is-invalid');
                            $('#loginForm').trigger('reset');
                            Swal.fire({
                                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                                text: res.message,
                                icon: 'error',
                                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                                confirmButtonColor: 'var(--primary-color)',
                                background: 'var(--light-color)',
                                iconColor: 'var(--primary-color)'
                            });
                        }

                    }).loginUser(formData);
                });
            }

            if (registerForm) {
                registerForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    let formData = {
                        uid: $('#uid').val(),
                        fullname: $('#fullname').val(),
                        phone: $('#phone').val(),
                        childname: $('#childname').val(),
                        username: $('#username').val(),
                        role: $('#registerRole').val(),
                        std_class: $('#registerRole').val() === 'Teacher' ? $('#registerClass').val() : '',
                        password: $('#registerPassword').val(),
                        confirmPassword: $('#confirmPassword').val(),
                    }
                    console.log("üöÄ ~ formData:", formData)

                    // Validate form data
                    if ($(this).find(':invalid').length > 0) {
                        $(this).find(':invalid').each(function () {
                            $(this).addClass('is-invalid');
                        });
                        Toast.fire({
                            icon: 'error',
                            title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
                        });
                    }

                    if (formData.password !== formData.confirmPassword) {
                        Toast.fire({
                            icon: 'error',
                            title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'
                        });
                        return;
                    }

                    $(this).find('button[type="submit"]').html('<span class="spinner-border spinner-border-sm me-2"></span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...').prop('disabled', true);
                    NProgress.start();
                    NProgress.inc();
                    google.script.run.withFailureHandler(e => console.log(e)).withSuccessHandler((res) => {
                        res = JSON.parse(res);
                        if (res.success) {
                            // Show success message
                            $('#registerForm').trigger('reset');
                            $('#registerForm').find('.form-control').removeClass('is-valid').removeClass('is-invalid');
                            $('#registerForm').find('button[type="submit"]').html('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô').prop('disabled', false);
                            Swal.fire({
                                title: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                                html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ<br> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ô‡∏≥‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ô 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ',
                                icon: 'success',
                                confirmButtonText: '‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                                confirmButtonColor: 'var(--primary-color)',
                                background: 'var(--light-color)',
                                iconColor: 'var(--primary-color)',
                                customClass: {
                                    popup: 'rounded-4'
                                }
                            })
                        } else {
                            // Show error message
                            Swal.fire({
                                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!',
                                text: res.message,
                                icon: 'error',
                                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                                confirmButtonColor: 'var(--primary-color)',
                                background: 'var(--light-color)',
                                iconColor: 'var(--primary-color)'
                            });
                        }

                    }).registerUser(formData);
                });
            }

            // Add background animation of floating coins
            const createStars = () => {
                const container = document.querySelector('body');
                const count = 8; // Reduced count for fewer coins
                const coinColors = ['#FFD700', '#FFC125', '#E6BE8A']; // Gold coin colors

                for (let i = 0; i < count; i++) {
                    const coin = document.createElement('div');
                    coin.className = 'coin-shape';

                    // Random positioning
                    coin.style.left = `${Math.random() * 90 + 5}%`;
                    coin.style.bottom = `-50px`; // Start from below the screen

                    // Slower animation by increasing duration
                    coin.style.animationDuration = `${Math.random() * 20 + 25}s`; // Much slower animation
                    coin.style.animationDelay = `${Math.random() * 10}s`; // Longer delay between animations

                    // Coin appearance
                    const size = Math.random() * 15 + 20; // Larger size for coins
                    coin.style.width = `${size}px`;
                    coin.style.height = `${size}px`;
                    coin.style.backgroundColor = coinColors[Math.floor(Math.random() * coinColors.length)];
                    coin.style.opacity = Math.random() * 0.1; // Higher opacity

                    // Add subtle 3D effect with box-shadow
                    coin.style.boxShadow = `inset -2px -2px 4px rgba(0,0,0,0.3), inset 2px 2px 4px rgba(255,255,255,0.3)`;

                    // Add a ‡∏ø symbol inside
                    const symbol = document.createElement('span');
                    symbol.innerHTML = '‡∏ø'; // Thai Baht symbol for School Bank
                    symbol.style.fontSize = `${size * 0.6}px`;
                    symbol.style.color = '#8B7500';
                    symbol.style.position = 'absolute';
                    symbol.style.top = '50%';
                    symbol.style.left = '50%';
                    symbol.style.transform = 'translate(-50%, -50%)';
                    symbol.style.fontWeight = 'bold';

                    coin.appendChild(symbol);
                    container.appendChild(coin);
                }
            };

            // // Only create background animation on larger screens
            // if (window.innerWidth > 100) {
            createStars();
            // }
        });
        let ROLE
        $(document).ready(function () {
            $(window).on('resize', function () {
                $('#logoutBtn').on('mouseenter', function () {
                    $('#logoutText').show(400)
                }).on('mouseleave', function () {
                    $('#logoutText').hide(400)
                });
            });
            $(window).trigger('resize');
        });

        $('#registerRole').on('change', function () {
            if ($(this).val() === 'Teacher') {
                $('#classContainer').removeClass('d-none');
            } else {
                $('#classContainer').addClass('d-none');
            }
        });

        $('#logoutBtn').on('click', function () {
            NProgress.start();
            NProgress.inc();
            window.open('<?!= ScriptApp.getService().getUrl() ?>?action=deposit_history&uid=' + $('#uid').val(), '_top');
        });

        function initLoginForm() {
            $('#authContainer').removeClass('d-none');
            $('#logoutBtnContainer').hide();
            $('#authTabsContent').removeClass('d-none');
            $('#authTabs').removeClass('d-none');
            $('#authContainer').fadeIn(500);
        }

        function initializeApp(res) {
            ROLE = res.userInfo.role;
            $('#currentUsername').text(res.userInfo.name);
            $('#userInfoContainer').show()
            $('#authContainer').hide();
            $('#logoutBtnContainer').show();
            $('#authTabsContent').removeClass('d-none');
            $('#authTabs').removeClass('d-none');
            initDepositTable()

        }

        let depositTable;
        function initDepositTable() {
            $('#main-table').fadeOut(500, function () {
                $('#mainContainer').removeClass('d-none').fadeIn(500);
                $('#logoutBtnContainer').show();
                $('#authTabsContent').addClass('d-none');
                $('#authTabs').addClass('d-none');
                // Initialize the cow data table
                depositTable = $('#main-table').DataTable({
                    responsive: true,
                    scrollX: true,
                    serverSide: false,
                    processing: true,
                    ajax: function (data, callback, settings) {
                        NProgress.start();
                        NProgress.inc();
                        google.script.run.withFailureHandler(e => console.log(e)).withSuccessHandler(res => {
                            res = JSON.parse(res);
                            console.log("üöÄ ~ google.script.run.withFailureHandler ~ res:", res)
                            NProgress.done();
                            callback({
                                recordsTotal: res.total,
                                recordsFiltered: res.total,
                                data: res.data
                            });
                        }).getData($('#uid').val(), ROLE);
                    },
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.7/i18n/th.json',
                    },
                    dom: '<"row"<"col-sm-12 col-md-6"B><"col-sm-12 col-md-6"f>>' +
                        '<"row"<"col-sm-12 mt-2"tr>>' +
                        '<"row justify-content-between mt-2"<"col-12 col-md-auto mt-2 text-center"i><"col-12 col-md-auto text-center"p>>',
                    buttons: {
                        dom: {
                            button: {
                                className: 'btn btn-beef'
                            }
                        },
                        buttons: getButtonsBasedOnRole(ROLE),
                    },
                    columns: [
                        {
                            data: null,
                            title: '#',
                            className: 'dt-head-center dt-head-nowrap all',
                            render: function (data, type, row, meta) {
                                if (type === 'display') {
                                    return meta.row + meta.settings._iDisplayStart + 1;
                                }
                                return meta.row;
                            }
                        },
                        {
                            data: 'date',
                            title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                            visible: false,
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return moment(data).format('DD/MM/YYYY HH:mm:ss');
                                }
                                return new Date(data).getTime();
                            }
                        },
                        {
                            data: 'userID',
                            title: '‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                            visible: false,
                        },
                        {
                            data: 'farmID',
                            title: '‡∏£‡∏´‡∏±‡∏™‡∏ü‡∏≤‡∏£‡πå‡∏°',
                            className: 'dt-head-center dt-head-nowrap dt-body-center' +
                                (ROLE !== 'Member' ? ' all' : ''),
                            visible: ROLE !== 'Member',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return `<span class="text-success">${data}</span>`;
                                }
                                return data;
                            }
                        },
                        {
                            data: 'cowID',
                            title: '‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏Ñ',
                            visible: false,
                            className: 'dt-head-center dt-head-nowrap',
                        },
                        {
                            data: 'cowName',
                            title: '<input type="checkbox" class="form-check-input d-none select-all-cows" id="select-all-cows"> ‡∏£‡∏´‡∏±‡∏™‡πÇ‡∏Ñ/‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ',
                            className: 'dt-head-center dt-head-nowrap dt-body-start all',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return row.cowStatus === '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß' ? `<span class="text-muted">${data}</span>` :
                                        (ROLE === 'Member' ? `<span class="text-muted">${data}</span>` :
                                            `<input type="checkbox" class="form-check-input d-none select-cow" data-id="${row.cowID}" data-name="${data}" data-gender="${row.cowGender}" data-farmid="${row.farmID}" id="select-cow-${row.cowID}" /><span class="ms-2">${row.cowName}</span>`);
                                }
                                return data;
                            }
                        },
                        {
                            data: 'birthDate',
                            title: '‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î',
                            className: 'dt-head-center dt-head-nowrap',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return moment(data).format('DD/MM/YYYY');
                                }
                                return new Date(data).getTime();
                            }
                        },
                        {
                            data: null,
                            title: '‡∏≠‡∏≤‡∏¢‡∏∏',
                            className: 'dt-head-center dt-head-nowrap all',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    let age_month = moment().diff(moment(row.birthDate), 'months')
                                    return age_month + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'
                                }
                                return moment().diff(moment(row.birthDate), 'months')
                            }
                        },
                        {
                            data: 'cowGender',
                            title: '‡πÄ‡∏û‡∏®',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',

                        },
                        {
                            data: 'fcowCode',
                            title: 'F‡πÇ‡∏Ñ',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                        },
                        {
                            data: 'motherCode',
                            title: '‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏°‡πà/‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡πà',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                        },
                        {
                            data: 'fmotherCode',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                            title: 'F‡πÅ‡∏°‡πà'
                        },
                        {
                            data: 'fatherCode',
                            title: '‡∏£‡∏´‡∏±‡∏™‡∏û‡πà‡∏≠/‡∏ä‡∏∑‡πà‡∏≠‡∏û‡πà‡∏≠',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                        },
                        // {
                        //     data: 'ffatherCode',
                        //     className: 'dt-head-center dt-head-nowrap dt-body-center',
                        //     title: 'F‡∏û‡πà‡∏≠'
                        // },
                        {
                            data: 'cowOwner',
                            title: '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ/‡∏ó‡∏µ‡πà‡∏°‡∏≤',
                            className: 'dt-head-center dt-head-nowrap dt-body-center all',
                        },
                        {
                            data: 'memberName',
                            title: '‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            className: 'dt-head-center dt-head-nowrap dt-body-center' +
                                (ROLE !== 'Member' ? ' all' : ''),
                        },
                        {
                            data: 'farmInDate',
                            title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≤‡∏£‡πå‡∏°',
                            visible: ROLE !== 'Member',
                            className: 'dt-head-center dt-head-nowrap dt-body-center' +
                                (ROLE !== 'Member' ? ' all' : ''),
                            render: function (data, type, row) {
                                if (data === '') return '';
                                if (type === 'display') {
                                    return moment(data).format('DD/MM/YYYY');
                                }
                                return new Date(data).getTime();
                            }
                        },
                        {
                            data: 'dataDate',
                            title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            className: 'dt-head-center dt-head-nowrap dt-body-center',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return moment(data).format('DD/MM/YYYY');
                                }
                                return new Date(data).getTime();
                            }
                        },
                        {
                            data: 'lastUpdate',
                            title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                            className: 'dt-head-center dt-head-nowrap',
                            render: function (data, type, row) {
                                if (type === 'display') {
                                    return moment(data).format('DD/MM/YYYY HH:mm:ss');
                                }
                                return new Date(data).getTime();
                            }
                        },
                        {
                            data: 'remark',
                            title: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏',
                            className: 'dt-head-center dt-head-nowrap',
                        },
                        {
                            data: null,
                            title: '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û',
                            className: 'dt-head-center dt-head-nowrap',
                            render: function (data, type, row) {
                                let images = [data.cowImage1, data.cowImage2, data.cowImage3, data.cowImage4, data.cowImage5].filter(img => img !== '');
                                if (images.length > 0) {
                                    return `<button class="btn btn-sm btn-beef" onclick="showImageCarousel('${images.join('||')}')">
                                        <i class="bi bi-images"></i> ‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (${images.length})
                                    </button>`;
                                } else {
                                    return '<div class="text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>';
                                }
                            }
                        },
                        {
                            data: 'cowStatus',
                            title: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                            orderable: false,
                            className: 'dt-head-center dt-head-nowrap dt-body-center all',
                            render: function (data) {
                                return `<button class="w-100 rounded-3 btn btn-sm btn-${data == '‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°' ? 'success' : data == '‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' ? 'primary' : 'muted'} change-status-btn ${ROLE === 'Member' ? 'pe-none' : ''}" ${ROLE === 'Member' ? '' : 'onclick="changeStatus(this)"'} data-status="${data}">
                                    ${ROLE === 'Member' ? '' : '<i class="fa-solid fa-arrow-pointer fa-flip-horizontal"></i>&nbsp;'}
                                    ${data}</button>`;
                            }
                        },
                        {
                            data: null,
                            orderable: false,
                            title: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£',
                            className: 'dt-head-center dt-head-nowrap dt-body-center all',
                            render: function (data, type, row) {
                                return ROLE === 'Member' && row['cowStatus'] !== '‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å' ? '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ' :
                                    ('<div class="btn-group btn-group-sm">' +
                                        '<button class="btn btn-warning" onclick="editCow(this)">' +
                                        '<i class="bi bi-pencil"></i>' +
                                        '</button>' +
                                        '<button class="btn btn-danger" onclick="deleteCow(this)">' +
                                        '<i class="bi bi-trash"></i>' +
                                        '</button>' +
                                        '</div>');
                            }
                        }
                    ],
                    columnDefs: [
                        {
                            targets: '_all',

                        },
                        {
                            targets: [2, 4, 16],
                            className: 'all'
                        },
                        {
                            targets: [2, 7, 15],
                            className: 'text-nowrap'
                        },
                    ],

                    order: [[1, 'desc']],
                    initComplete: function (settings, json) {

                        // Add event listener for the "select all" checkbox
                        $('.select-all-cows').on('change', function () {
                            if ($(this).is(':checked')) {
                                $('.select-cow').prop('checked', true);
                            } else {
                                $('.select-cow').prop('checked', false);
                            }
                            // Trigger change event on select-cow checkboxes to update UI
                            $('.select-cow').trigger('change');
                        });
                        // Add status filter dropdown for non-Member users
                        if (ROLE !== 'Member') {
                            // Replace status column header with select dropdown
                            let statusFilterHtml = `
                                <select class="form-select status-filter">
                                    <option value="" selected>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                                    <option value="‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°">‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ü‡∏≤‡∏£‡πå‡∏°</option>
                                    <option value="‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å">‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</option>
                                    <option value="‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</option>
                                </select>
                            `;

                            $(cowDataTable.column(20).header()).html(statusFilterHtml);
                            // Prevent sorting when clicking on the status filter dropdown
                            $('.status-filter').on('click', function (e) {
                                e.stopPropagation();
                            });

                            // Add filtering functionality
                            $('.status-filter').on('change', function () {
                                let filterValue = $(this).val();
                                cowDataTable.column(20).search(filterValue).draw();
                            });
                        }
                        NProgress.done();

                    },
                });
                NProgress.done();
            });
        }

        function getButtonsBasedOnRole(role) {
            // Base button that all users have
            let buttons = [
                {
                    text: '<i class="bi bi-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ',
                    className: 'btn btn-bank',
                    action: function () {
                        $('form#addCowForm').removeAttr('data-editmode')
                        $('#addCowModal').modal('show');
                    }
                }
            ];

            // Add additional buttons based on role
            buttons.push(
                {
                    text: '<i class="bi bi-file-earmark-arrow-up"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å',
                    className: 'btn btn-bank btn-enable-select' + (ROLE === 'Member' ? ' d-none' : ''),
                    action: function () {
                        if ($('.btn-enable-select').hasClass('cancel-select')) {
                            // Exit selection mode
                            $('.btn-enable-select').removeClass('cancel-select')
                                .html('<i class="bi bi-file-earmark-arrow-up"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å')
                                .removeClass('btn-danger').addClass('btn-bank');
                            $('.select-cow, .select-all-cows').prop('checked', false).addClass('d-none');
                            $('.btn-export-bank').attr('disabled', true).addClass('d-none');
                            return;
                        }

                        // Enter selection mode
                        $('.btn-enable-select').html('<i class="bi bi-file-earmark-arrow-down"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')
                            .addClass('btn-danger cancel-select').removeClass('btn-bank');
                        $('.select-cow, .select-all-cows').removeClass('d-none');

                        // Handle checkbox changes
                        $('.select-cow').on('change', function () {
                            let selectedCows = $('.select-cow:checked').length;
                            let totalSelectableCows = $('.select-cow:visible').length;

                            // Update the export button visibility
                            if (selectedCows > 0) {
                                $('.btn-export-bank').removeAttr('disabled').removeClass('d-none');
                            } else {
                                $('.btn-export-bank').attr('disabled', true).addClass('d-none');
                            }

                            // Update "select all" checkbox state
                            if (selectedCows === 0) {
                                $('.select-all-cows').prop('checked', false);
                            } else if (selectedCows === totalSelectableCows) {
                                $('.select-all-cows').prop('checked', true);
                            } else {
                                // If some but not all are selected, keep the header checkbox unchecked
                                $('.select-all-cows').prop('checked', false);
                            }
                        });
                    }
                },
                {
                    text: '<i class="bi bi-file-earmark-arrow-up"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÇ‡∏Ñ',
                    className: 'btn btn-export-bank d-none', // Add d-none class
                    action: function () {
                        let selectedCows = $('.select-cow:checked').toArray().map(function (checkbox) {
                            return {
                                cowID: $(checkbox).data('id'),
                                name: $(checkbox).data('name'),
                                gender: $(checkbox).data('gender'),
                                farmID: $(checkbox).data('farmid'),
                            }
                        });
                        if (selectedCows.length === 0) {
                            Toast.fire({
                                icon: 'error',
                                title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å'
                            });
                            return;
                        }
                        showExportFormModal(selectedCows);
                    }
                }
            );
            return buttons;
        }

        function showImagePreview(src) {
            Swal.fire({
                imageUrl: src,
                imageWidth: '100%',
                imageHeight: '100%',
                showCloseButton: true,
                showConfirmButton: false,
                allowOutsideClick: false
            });
        }

        function showImageCarousel(images) {
            const imageArray = images.split('||');
            const imageElements = imageArray.map((img, index) => {
                return `<div class="carousel-item ${index === 0 ? 'active' : ''}">
                            <img src="${img}" class="d-block w-100" alt="Image ${index + 1}">
                        </div>`;
            }).join('');

            Swal.fire({
                html: `<div id="imageCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        ${imageArray.map((_, index) =>
                    `<button type="button" data-bs-target="#imageCarousel" data-bs-slide-to="${index}" 
                            ${index === 0 ? 'class="active" aria-current="true"' : ''} 
                            aria-label="Slide ${index + 1}"
                            style="background-color: var(--primary-color);"></button>`
                ).join('')}
                    </div>
                    <div class="carousel-inner">
                        ${imageElements}
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#imageCarousel" data-bs-slide="prev" 
                            style="opacity: 0.9;">
                        <span class="carousel-control-prev-icon" aria-hidden="true" 
                              style="filter: invert(25%) sepia(71%) saturate(935%) hue-rotate(346deg) brightness(89%) contrast(84%);"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#imageCarousel" data-bs-slide="next"
                            style="opacity: 0.9;">
                        <span class="carousel-control-next-icon" aria-hidden="true"
                              style="filter: invert(25%) sepia(71%) saturate(935%) hue-rotate(346deg) brightness(89%) contrast(84%);"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
               `,
                padding: '0',
                customClass: {
                    popup: 'rounded-4 col-12 col-md-8 col-lg-6',
                    image: 'rounded-4',
                    htmlContainer: 'p-0 rounded-4',
                },
                showCloseButton: true,
                showConfirmButton: false,
            });
        }

        $('#username').on('input', function () {
            clearTimeout(this.timer);
            this.timer = setTimeout(() => {
                const username = $(this).val();
                if (username.length < 6) {
                    $(this).addClass('is-invalid');
                    $('#invalid-username').text('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
                } else if (/\s/g.test(username)) {
                    $(this).addClass('is-invalid');
                    $('#invalid-username').text('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ');
                } else if (!/^[a-zA-Z0-9]+$/.test(username)) {
                    $(this).addClass('is-invalid');
                    $('#invalid-username').text('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                }

                else {
                    $(this).addClass('is-invalid')
                    $('#invalid-username').html('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...<i class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></i>');
                    google.script.run.withFailureHandler(e => console.log(e)).withSuccessHandler(res => {
                        if (res) {
                            $(this).removeClass('is-invalid').addClass('is-valid');
                            $('#invalid-username').html('');
                        } else {
                            $(this).addClass('is-invalid');
                            $('#invalid-username').html('<i class="bi bi-x-circle-fill text-danger"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
                        }
                    }).checkUsername(username)
                }
            }, 500);
        });

        $('#registerPassword').on('input', function () {
            const password = $(this).val();
            $('#confirmPassword').removeClass('is-valid').removeClass('is-invalid').text('');
            if (password.length < 8) {
                $(this).addClass('is-invalid');
                $(this).removeClass('is-valid');
                $(this).next('.invalid-feedback').show().text('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£');
            } else {
                $(this).removeClass('is-invalid').addClass('is-valid');
            }
        });

        $('#confirmPassword').on('input', function () {
            const password = $('#registerPassword').val();
            const confirmPassword = $('#confirmPassword').val();
            if (password !== confirmPassword) {
                $('#confirmPassword').addClass('is-invalid');
                $('#confirmPassword').removeClass('is-valid');
                $('#confirmPassword').next('.invalid-feedback').show().text('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
            } else {
                $('#confirmPassword').removeClass('is-invalid').addClass('is-valid');
                $('#confirmPassword').next('.valid-feedback').show().text('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô');
            }
        });

        window.addEventListener("load", function () {
            NProgress.done();
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="th">

<head>
    <!-- no cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- no cache -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HENG MONEY - เฮงมันนี่ 4289</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css"
        integrity="sha512-MQXduO8IQnJVq1qmySpN87QQkiR1bZHtorbJBD0tzy7/0U9+YIC93QWHeGTEoojMVHWWNkoCp8V6OzVSYrX0oQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/themes/dark.min.css"
        integrity="sha512-9j8LE+fuBZgXOsSyiXCw0LmM4LSLIo94AYem4pQzyqlbw5wC4qK2ytHjOLy9pGH3DbvoXawLPuiVfr8gXOKXWw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.datatables.net/v/bs5/moment-2.29.4/dt-2.3.2/date-1.5.6/r-3.0.5/datatables.min.css"
        rel="stylesheet" integrity="sha384-g0oloLK74xcQRricIumqtIsduu+rbd99qhw8i5tH9wmlmVs+qbGMfVvC/ry8OrG0"
        crossorigin="anonymous">
    <style>
        * {
            font-family: 'Noto Sans Thai', sans-serif !important;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .gold-title {
            color: #d4af37;
            letter-spacing: 2px;
            text-shadow: 0 2px 8px #000;
            font-family: 'Merriweather', 'Noto Sans Thai', sans-serif !important;
        }

        body {
            background: linear-gradient(135deg, #232526 0%, #1a1a1a 100%);
            min-height: 100vh;
        }

        .gold-form-card {
            background: #232526;
            border: 2px solid #d4af37;
            color: #fff;
        }


        .logo-img {
            width: 120px;
            height: 120px;
            object-fit: contain;
            border-radius: 16px;
            box-shadow: 0 4px 16px #d4af3744;
            background: #232526;
            padding: 12px;
        }

        .gold-btn {
            background: linear-gradient(90deg, #d4af37 0%, #232526 100%);
            color: #fff;
            border: none;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px #d4af3744;
            transition: background 0.3s;
        }

        .gold-btn:hover {
            background: linear-gradient(90deg, #232526 0%, #d4af37 100%);
            color: #d4af37;
        }

        label.form-label {
            color: #d4af37;
            font-weight: 500;
        }

        .form-control,
        .form-select {
            border: 1.5px solid #d4af37;
            background: #232526;
            color: #fff;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #d4af37;
            box-shadow: 0 0 0 2px #d4af3722;
            background: #232526;
            color: #fff;
        }
    </style>
</head>

<body>
    <section id="form-sec">
        <button type="button" class="btn gold-btn w-100 mb-4" data-bs-toggle="modal" data-bs-target="#goldTableModal">
            ดูข้อมูลการขาย
        </button>
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-6 col-md-8">
                    <div class="card shadow-lg border-0 rounded-4 gold-form-card">
                        <div class="card-body p-4">
                            <div class="text-center mb-4">
                                <img src="https://img5.pic.in.th/file/secure-sv1/b6ea3192-e74b-4483-a7a5-ac5f86a81191.png"
                                    alt="โลโก้" class="logo-img mb-2">
                                <h2 class="fw-bold gold-title mt-3">HENG MONEY 4289</h2>
                            </div>
                            <form id="goldForm" onsubmit="submitForm(event)">
                                <div class="mb-3">
                                    <label for="date" class="form-label">วันที่ซื้อ</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="date" name="date"
                                            placeholder="เลือกวันที่" required>
                                        <button class="btn btn-outline-warning" type="button" id="calendarBtn"
                                            style="border-color: #d4af37; color: #d4af37; background: #232526;">
                                            <i class="bi bi-calendar"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="category" class="form-label">หมวดหมู่</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="" disabled selected></option>
                                        <? lists.category.forEach(function (item) { ?>
                                            <option value="<?= item ?>"><?= item ?></option>
                                        <? }) ?>
                                        <!-- <option value="ทอง">ทอง</option>
                                        <option value="เงิน">เงิน</option>
                                        <option value="ทองจากตั๋ว">ทองจากตั๋ว</option> -->
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="product" class="form-label">สินค้า (คีย์%)</label>
                                    <input type="text" class="form-control" id="product" name="product"
                                        placeholder="เช่น ทอง71" required>
                                </div>
                                <div class="mb-3">
                                    <label for="weight" class="form-label">น้ำหนัก (กรัม)</label>
                                    <input type="number" class="form-control" id="weight" name="weight" min="0"
                                        step="0.01" required>
                                </div>
                                <div class="mb-3">
                                    <label for="price" class="form-label">ยอดซื้อ (บาท)</label>
                                    <input type="number" class="form-control" id="price" name="price" min="0"
                                        step="0.01" required>
                                </div>
                                <div class="mb-3">
                                    <label for="bank" class="form-label">ธนาคาร</label>
                                    <select class="form-select" id="bank" name="bank" required>
                                        <option value="" disabled selected></option>
                                        <? lists.bank.forEach(function (item) { ?>
                                            <option value="<?= item ?>"><?= item ?></option>
                                        <? }) ?>
                                        <!-- <option value="สด">สด</option>
                                        <option value="บช.1">บช.1</option>
                                        <option value="บช.2">บช.2</option> -->
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label for="staff" class="form-label">พนักงาน</label>
                                    <select class="form-select" id="staff" name="staff" required>
                                        <option value="" disabled selected></option>
                                        <? lists.staff.forEach(function (item) { ?>
                                            <option value="<?= item ?>"><?= item ?></option>
                                        <? }) ?>
                                        <!-- <option value="staffA">staffA</option>
                                        <option value="staffB">staffB</option> -->
                                    </select>
                                </div>
                                <button type="submit" class="btn gold-btn w-100 py-2 fw-bold">บันทึกข้อมูล</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Modal for gold table -->
    <div class="modal fade" id="goldTableModal" tabindex="-1" aria-labelledby="goldTableModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content gold-form-card">
                <div class="modal-header border-0" style="background: #232526;">
                    <h3 class="modal-title gold-title w-100 text-center" id="goldTableModalLabel">ข้อมูลการขาย</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        style="filter: invert(1);"></button>
                </div>
                <div class="modal-body p-2">
                    <div class="table-responsive">
                        <table id="goldTable" class="table table-striped table-bordered table-hover" style="width: 100%;"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            moment.locale('th');
            flatpickr("#date", {
                locale: "th",
                dateFormat: "Y-m-d",
                allowInput: true,
                theme: "dark"
            });
            $("#calendarBtn").on("click", function () {
                $("#date").flatpickr().open();
            });
            $('#goldTableModal').on('show.bs.modal', function () {
                if ($.fn.dataTable.isDataTable('#example')) {
                    $('#goldTable').DataTable().ajax.reload();
                } else {
                    initDataTable();
                }
            });
        });
        function initDataTable() {
            $('#goldTable').DataTable({
                responsive: true,
                processing: true,
                serverSide: false,
                ajax: function (data, callback, settings) {
                    NProgress.start();
                    google.script.run.withSuccessHandler(function (response) {
                        response = JSON.parse(response);
                        NProgress.done();
                        callback({
                            data: response,
                            recordsTotal: response.length,
                            recordsFiltered: response.length
                        });
                    }).withFailureHandler(function (error) {
                        NProgress.done();
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: error.message || error,
                        });
                    }).getSellData();
                },
                columns: [
                    {
                        data: null,
                        title: '#',
                        orderable: false,
                        searchable: false,
                        render: function (data, type, row, meta) {
                            return meta.row + 1;
                        }
                    },
                    { 
                        data: 'date',
                        title: 'วันที่',
                        render: function (data) {
                            return moment(data).format('DD/MM/YYYY');
                        }
                    },


                ],
            });
        }

        function submitForm(e) {
            e.preventDefault();
            const form = document.getElementById('goldForm');
            const data = {
                date: form.date.value,
                category: form.category.value,
                product: form.product.value,
                weight: form.weight.value,
                price: form.price.value,
                bank: form.bank.value,
                seller: form.staff.value
            };
            NProgress.start();
            google.script.run.withSuccessHandler(function () {
                NProgress.done();
                $('#goldTable').DataTable().ajax.reload();
                Swal.fire({
                    icon: 'success',
                    title: 'บันทึกสำเร็จ',
                    showConfirmButton: false,
                    timer: 1500
                });
                form.reset();
            }).withFailureHandler(function (error) {
                NProgress.done();
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: error.message || error,
                });
            }).saveSellData(data);
        }

        function deleteRow(date) {
        Swal.fire({
            title: 'กรุณากรอกชื่อพนักงานเพื่อยืนยันการลบ',
            input: 'select',
            inputOptions: $('#staff').find('option').toArray().reduce((acc, option) => {
                acc[option.value] = option.text;
                return acc;
            }, {}),
            inputPlaceholder: 'เลือกชื่อพนักงาน',
            showCancelButton: true,
            confirmButtonText: 'ลบ',
            cancelButtonText: 'ยกเลิก',
            inputValidator: (value) => {
                if (!value) {
                    return 'กรุณาเลือกชื่อพนักงาน';
                }
            }
        }).then((result) => {
            if (result.isConfirmed && result.value) {
                NProgress.start();
                google.script.run.withSuccessHandler(function () {
                    NProgress.done();
                    $('#goldTable').DataTable().ajax.reload();
                    Swal.fire({
                        icon: 'success',
                        title: 'ลบข้อมูลสำเร็จ',
                        showConfirmButton: false,
                        timer: 1500
                    });
                }).withFailureHandler(function (error) {
                    NProgress.done();
                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: error.message || error,
                    });
                }).deleteSellData(date, result.value);
            }
        });
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/locale/th.js"></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.jin
        integrity=" sha512-K/oyQtMXpxI4+K0W7H25UopjM8pzq0yrVdFdG21Fh5dBe91I40pDd9A4lzNlHPHBIP2cwZuoxaUSX0GJSObvGA=="
        crossorigin=" anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.11/l10n/th.min.js"
        integrity="sha512-0XU8EDwsRqhnSukLw3KIQoRvFJs3SGlsoLpX1RpRAjmYrc7w56F6J5pwJ0p0p+v23qg14VPRQe9OhPRfbhVzdw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdn.datatables.net/v/bs5/moment-2.29.4/dt-2.3.2/date-1.5.6/r-3.0.5/datatables.min.js"
        integrity="sha384-F3T/anccpuD+tGZ5UGTEAOJtJLvpPX297Nw0Hdszm40Bf3AxlRa135uEORYCRHpv"
        crossorigin="anonymous"></script>
    <script>
        AOS.init();
        document.addEventListener("DOMContentLoaded", function () {
            NProgress.start();
            NProgress.inc()
        });
        window.addEventListener("load", function () {
            NProgress.done();
        });

    </script>

</body>

</html>
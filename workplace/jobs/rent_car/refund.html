<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <base target="_top">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"
        integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100%;
            height: 80vh;
            font-family: 'Prompt', sans-serif;
            color: #0A1829
        }

        .container {
            max-width: 600px;
        }

        table tr th,
        table tr td {
            vertical-align: middle;
        }

        .container {
            max-width: 600px;
        }

        .btn-select {
            background-color: #62c3e8;
            color: '#0A1829';
            transition: all 0.3s ease-in-out;
        }

        .btn-select:hover {
            background-color: #07111D;
            color: #A1C1E8;
            transition: all 0.3s ease-in-out;
        }

        .form-control:focus {
            box-shadow: 0 0 0 0.2rem rgba(112, 124, 192, 0.3);
        }

        .form-select:focus {
            box-shadow: 0 0 0 0.2rem rgba(112, 124, 192, 0.3);
        }

        .bg-brand {
            background-color: rgba(0, 174, 219, 0.1);
        }

        .text-brand {
            color: #00AEDB;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                opacity: 1;
            }

            50% {
                transform: scale(1.05);
                opacity: 1;
            }

            100% {
                transform: scale(0.95);
                opacity: 1;
            }
        }

        body.loading {
            overflow: hidden;
        }

        /* Select2 Custom Bank Styling */
        .select2-container--bootstrap-5 .select2-selection {
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
        }

        /* .bank-option {
            display: flex;
            align-items: center;
            padding: 8px;
        }
        
        .bank-option img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            object-fit: contain;
        }
        
        .bank-option-text {
            display: inline-block;
            vertical-align: middle;
        }
        
        .select2-container--bootstrap-5 .select2-results__option--highlighted {
            background-color: rgba(0, 174, 219, 0.1) !important;
            color: #0A1829 !important;
        }
        
        .select2-container--bootstrap-5 .select2-results__option--selected {
            background-color: rgba(0, 174, 219, 0.2) !important;
            color: #0A1829 !important;
        } */
    </style>
    <title>Touch Car Refund</title>
</head>

<body class="container-fluid">
    <div id="loadingOverlay" class="position-fixed top-0 start-0 w-100 h-100"
        style="z-index: 9999; display: none; background-color: rgba(255,255,255, 0.5); flex-direction: column; justify-content: center; align-items: center;">
        <div class="text-center d-flex flex-column justify-content-center align-items-center">
            <img src="./detail_request.png" alt="Loading" class="img-fluid mb-3"
                style="max-height: 250px; animation: pulse 1.5s infinite;">
        </div>
    </div>

    <header>
        <div class="row">
            <div class="col-12 text-center">
                <img src="https://img5.pic.in.th/file/secure-sv1/50d66255-4b76-4a9a-82b2-ecd9e0e1ef3b-removebg-preview.png"
                    alt="brand" class="img-fluid" style="max-height: 250px;">
            </div>
        </div>
    </header>
    <div class="container p-2" id="main">
        <div class="row mb-3">
            <div class="col-12 text-center">
                <h3>‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ</h3>
                <h5>Refund Form</h5>
            </div>
        </div>
        <form id="mainform" class="needs-validation" novalidate>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• -->
                    <label for="full_name">
                        <i class="fa-solid fa-user"></i>
                        ‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• / Name - surname
                    </label>
                    <input type="text" class="form-control rounded-3" id="full_name" name="full_name" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô -->
                    <label for="id_number">
                        <i class="fa-solid fa-id-card"></i>
                        ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô / ID Number
                    </label>
                    <input type="text" class="form-control rounded-3" id="id_number" name="id_number" maxlength="13"
                        pattern="[0-9]{13}" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡∏≠‡∏µ‡πÄ‡∏°‡∏• -->
                    <label for="email">
                        <i class="fa-solid fa-envelope"></i>
                        E-Mail
                    </label>
                    <input type="email" class="form-control rounded-3" id="email" name="email" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤ -->
                    <label for="car_plate">
                        <i class="fa-solid fa-car"></i>
                        ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤ / Car plate number
                    </label>
                    <input type="text" class="form-control rounded-3" id="car_plate" name="car_plate" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ -->
                    <label for="bank_name">
                        <i class="fa-solid fa-building-columns"></i>
                        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ / Bank Name
                    </label>
                    <select class="form-select rounded-3" id="bank_name" name="bank_name" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ / Select bank</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (BBL)" data-logo="./bbl.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (BBL)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBANK)" data-logo="./kbank.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBANK)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ (KTB)" data-logo="./ktb.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢ (KTB)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå (SCB)" data-logo="./scb.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå (SCB)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡πà‡∏≤‡∏ï (TTB)" data-logo="./ttb.png">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏ó‡∏¢‡∏ò‡∏ô‡∏ä‡πà‡∏≤‡∏ï (TTB)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤ (BAY)" data-logo="./bay.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏£‡∏∏‡∏á‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤ (BAY)
                        </option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£ (‡∏ò‡∏Å‡∏™.) (BAAC)" data-logo="./baac.png">
                            ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
                            ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏™‡∏´‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£ (‡∏ò‡∏Å‡∏™.) (BAAC)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô (GSB)" data-logo="./gsb.jpg">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏≠‡∏≠‡∏°‡∏™‡∏¥‡∏ô (GSB)</option>
                        <option value="‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏ô‡∏î‡πå‡πÅ‡∏≠‡∏ô‡πÄ‡∏Æ‡πâ‡∏≤‡∏™‡πå (LHFG)" data-logo="./lhfg.png">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡πÅ‡∏•‡∏ô‡∏î‡πå‡πÅ‡∏≠‡∏ô‡πÄ‡∏Æ‡πâ‡∏≤‡∏™‡πå (LHFG)
                        </option>
                        <option value="other" data-logo="">‡∏≠‡∏∑‡πà‡∏ô‡πÜ / Other</option>
                    </select>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
                    </div>
                </div>
                <div class="col-12 d-none mt-3" id="other_bank_div">
                    <!-- ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
                    <label for="other_bank">
                        <i class="fa-solid fa-building-columns"></i>
                        ‡∏£‡∏∞‡∏ö‡∏∏‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ / Specify bank
                    </label>
                    <input type="text" class="form-control rounded-3" id="other_bank" name="other_bank">
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <!-- ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ -->
                    <label for="bank_number">
                        <i class="fa-solid fa-credit-card"></i>
                        ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ / Bank Number
                    </label>
                    <input type="text" class="form-control rounded-3" id="bank_number" name="bank_number" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
                    </div>
                </div>
            </div>
            <div class="row mb-3 justify-content-center border rounded-3 p-3 shadow-sm bg-light">
                <div class="col-12">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="confirmed" id="confirm_checkbox"
                            name="confirm_checkbox" required>
                        <label class="form-check-label" for="confirm_checkbox">
                            ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ ‡∏Ç‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£
                        </label>
                        <div class="invalid-feedback">
                            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </div>
                    </div>
                </div>
                <div class="col-12 text-center mt-5">
                    <button class="btn btn-primary rounded-3 w-75" id="submit" type="submit">
                        <i class="fa-solid fa-paper-plane"></i>
                        ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• / Submit
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        // var vConsole = new window.VConsole();
    </script>
    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwkUvyRi7u9RrGmTTqIwlKFQNRkp4vvgSz9ql6mKbrKVm1EopIK-39T7zOVrW_MnlziMA/exec'

        $(document).ready(() => {
            showLoading();

            // Function to ensure Select2 width is properly set
            function refreshSelect2() {
                setTimeout(function() {
                    $('.select2-container').css('width', '100%');
                }, 100);
            }

            // Call the refresh function on window resize
            $(window).resize(function() {
                refreshSelect2();
            });

            // Also trigger this when the DOM is ready to ensure initial sizing is correct
            refreshSelect2();
            // Initialize Select2 for bank dropdown with custom template
            $('#bank_name').select2({
                theme: 'bootstrap-5',
                dropdownParent: $('#bank_name').parent(),
                templateResult: formatBankOption,
                templateSelection: formatBankSelection
            });

            // Bank selection logic
            $('#bank_name').change(function () {
                if ($(this).val() == 'other') {
                    $('#other_bank_div').removeClass('d-none');
                    $('#other_bank').prop('required', true);
                } else {
                    $('#other_bank_div').addClass('d-none');
                    $('#other_bank').prop('required', false);
                }
            });

            init();
            // hideLoading();
        });

        // Format bank options in dropdown
        function formatBankOption(bank) {
            if (!bank.id) {
                return bank.text;
            }

            const $option = $(bank.element);
            const logoUrl = $option.data('logo');

            if (!logoUrl) {
                return bank.text;
            }

            const $result = $(
                '<div class="bank-option">' +
                '<img src="' + logoUrl + '" alt="Bank logo" width="30" height="30" class="me-2 rounded" />' +
                '<span class="bank-option-text">' + bank.text + '</span>' +
                '</div>'
            );

            return $result;
        }

        // Format selected bank in dropdown
        function formatBankSelection(bank) {
            if (!bank.id) {
                return bank.text;
            }

            const $option = $(bank.element);
            const logoUrl = $option.data('logo');

            if (!logoUrl) {
                return bank.text;
            }

            const $result = $(
                '<div class="bank-option">' +
                '<img src="' + logoUrl + '" alt="Bank logo" width="20" height="20" class="me-2 rounded-1" />' +
                '<span class="bank-option-text">' + bank.text + '</span>' +
                '</div>'
            );

            return $result;
        }

        function init() {
            liff.init({ liffId: '1655873446-MpmBPPzl' })
            liff.ready.then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login()
                } else {
                    // Get profile if needed
                    liff.getProfile().then(profile => {
                        // You can pre-fill form fields if needed
                        console.log("LINE Profile loaded");
                    }).catch(err => {
                        console.error(err)
                    });
                }
            }).catch(err => {
                console.error(err)
            });
        }

        function submit() {
            showLoading('./waiting.png', true);

            let data = $('#mainform').serializeArray().reduce((obj, item) => {
                obj[item.name] = item.value
                return obj
            }, { opt: 'refund' });

            // Add LINE user ID if available
            if (liff.isLoggedIn()) {
                try {
                    data.uid = liff.getDecodedIDToken().sub;
                    data.line_name = liff.getDecodedIDToken().name;
                } catch (e) {
                    console.error("Could not get LINE user ID", e);
                }
            }

            // Handle other bank selection
            if (data.bank_name === 'other' && data.other_bank) {
                data.bank_name = data.other_bank;
            }

            if(data.confirm_checkbox == 'confirmed'){
                data.confirm_checkbox = $('label[for="confirm_checkbox"]').text().trim();
            }else{
                data.confirm_checkbox = '';
            }
            delete data.other_bank;
            let pormises = [
                saveToSheet(data),
                sendToLine(data)
            ]
            Promise.all(pormises).then(() => {
                hideLoading();
                console.log("Data submitted successfully");
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    html: '<div class="text-center"><img src="./thank.png" alt="Success" class="img-fluid mb-3" style="max-height: 150px;"></div>',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    customClass: {
                        popup: 'rounded-4',
                    }
                }).then(() => {
                    // Close LIFF window or redirect
                    if (liff.isInClient()) {
                        liff.closeWindow();
                    } else {
                        // Redirect to a thank you page or reset form
                        $('#mainform')[0].reset();
                        // Reset Select2 dropdown
                        $('#bank_name').val('').trigger('change');
                    }
                });
            }).catch((err) => {
                hideLoading();
                Swal.fire({
                    icon: 'error',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                    customClass: {
                        popup: 'rounded-4',
                    }
                });
                console.error("Error submitting data", err);
            });
            console.log("Submitting data:", data);


        }

        function showLoading(img, isloading) {
            if (img) {
                $('#loadingOverlay').find('img').attr('src', img)
            }
            if (isloading) {
                $('#loadingOverlay').find('img').addClass('loading')
            } else {
                $('#loadingOverlay').find('img').removeClass('loading')
            }
            $('#loadingOverlay').fadeIn(300).css('display', 'flex');
            $('body').addClass('loading');
            setTimeout(() => {
                hideLoading();
            }, 4000);
        }

        function hideLoading() {
            $('#loadingOverlay').fadeOut(500);
            $('body').removeClass('loading');
        }

        async function saveToSheet(data) {
            console.log("üöÄ ~ saveToSheet ~ data:", data)
            return await new Promise((resolve, reject) => {
                $.post(scriptURL, data, function (res) {
                    hideLoading();
                    if (res.success) {
                        $('#mainform')[0].reset();
                        resolve(res);
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                            customClass: {
                                popup: 'rounded-4',
                            }
                        });
                        reject(res);
                    }
                }).fail(function () {
                    hideLoading();
                    Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        customClass: {
                            popup: 'rounded-4',
                        }
                    });
                    reject();
                });
            });

        }

        function sendToLine(data) {
            return new Promise((resolve, reject) => {
                // Create a Flex Message
                let flexMessage = {
                    type: "flex",
                    altText: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ",
                    contents: {
                        type: "bubble",
                        size: "giga",
                        header: {
                            type: "box",
                            layout: "vertical",
                            contents: [
                                {
                                    type: "text",
                                    text: "üí∞ ‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ",
                                    weight: "bold",
                                    size: "xl",
                                    color: "#ffffff",
                                    align: "center",
                                    wrap: true
                                }
                            ],
                            backgroundColor: "#0078D7",
                            paddingAll: "15px"
                        },
                        body: {
                            type: "box",
                            layout: "vertical",
                            contents: [
                                {
                                    type: "box",
                                    layout: "vertical",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤",
                                            weight: "bold",
                                            color: "#1DB446",
                                            size: "md",
                                            wrap: true
                                        },
                                        {
                                            type: "box",
                                            layout: "vertical",
                                            contents: [
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.full_name,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                },
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.id_number,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                },
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.email,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                }
                                            ],
                                            margin: "md"
                                        }
                                    ],
                                    paddingBottom: "15px",
                                    paddingTop: "5px"
                                },
                                {
                                    type: "separator"
                                },
                                {
                                    type: "box",
                                    layout: "vertical",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üöò ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ",
                                            weight: "bold",
                                            color: "#1DB446",
                                            size: "md",
                                            wrap: true
                                        },
                                        {
                                            type: "box",
                                            layout: "vertical",
                                            contents: [
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.car_plate,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                }
                                            ],
                                            margin: "md"
                                        }
                                    ],
                                    paddingBottom: "15px",
                                    paddingTop: "15px"
                                },
                                {
                                    type: "separator"
                                },
                                {
                                    type: "box",
                                    layout: "vertical",
                                    contents: [
                                        {
                                            type: "text",
                                            text: "üí≥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£",
                                            weight: "bold",
                                            color: "#1DB446",
                                            size: "md",
                                            wrap: true
                                        },
                                        {
                                            type: "box",
                                            layout: "vertical",
                                            contents: [
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.bank_name,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                },
                                                {
                                                    type: "box",
                                                    layout: "horizontal",
                                                    contents: [
                                                        {
                                                            type: "text",
                                                            text: "‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:",
                                                            size: "sm",
                                                            color: "#555555",
                                                            flex: 2,
                                                            wrap: true
                                                        },
                                                        {
                                                            type: "text",
                                                            text: data.bank_number,
                                                            size: "sm",
                                                            color: "#111111",
                                                            flex: 4,
                                                            wrap: true
                                                        }
                                                    ]
                                                }
                                            ],
                                            margin: "md"
                                        }
                                    ],
                                    paddingBottom: "15px",
                                    paddingTop: "15px"
                                }
                            ],
                            paddingAll: "20px"
                        },
                        footer: {
                            type: "box",
                            layout: "vertical",
                            contents: [
                                {
                                    type: "text",
                                    text: '‡∏Ç‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤ "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
                                    size: "sm",
                                    color: "#FF0000",
                                    align: "center",
                                    adjustMode: "shrink-to-fit",
                                }
                            ]
                        }
                    }
                };

                // Send the messages to LINE
                liff.sendMessages([
                    flexMessage
                ]).then(() => {
                    console.log('message sent');
                    resolve();
                }).catch((err) => {
                    console.error(err);
                    reject(err);
                });
                // liff.sendMessages([{
                //     type: 'text',
                //     text: message
                // }, {
                //     type: 'image',
                //     originalContentUrl: data.image,
                //     previewImageUrl: data.image
                // }]).then(() => {
                //     console.log('message sent');
                //     resolve()
                // }).catch((err) => {
                //     console.error(err);
                // });
            })

        }



        // Form validation
        (function () {
            'use strict'
            const form = document.querySelector('.needs-validation')
            form.addEventListener('submit', async function (event) {
                event.preventDefault()
                if (form.checkValidity() === false) {
                    event.stopPropagation()
                    form.classList.add('was-validated')
                    return $(form).find(':invalid').first().focus()
                }
                submit()
            })
        })()
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/locale/th.js"></script>
    <script src=" https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- dont keep cach -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <!-- dont keep cach -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายการขาย</title>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.datatables.net/v/bs5/dt-2.1.8/date-1.5.4/r-3.0.3/rg-1.5.1/datatables.min.css"
    rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <!-- icon -->
  <link rel="icon" href="https://img.icons8.com/pulsar-color/96/sell.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Mitr', sans-serif;
    }

    /* From Uiverse.io by Nawsome */
    .loader {
      --background: linear-gradient(135deg, #23C4F8, #275EFE);
      --shadow: rgba(39, 94, 254, 0.28);
      --text: #6C7486;
      --page: rgba(255, 255, 255, 0.36);
      --page-fold: rgba(255, 255, 255, 0.52);
      --duration: 3s;
      width: 200px;
      height: 140px;
      position: relative;
    }

    .loader:before,
    .loader:after {
      --r: -6deg;
      content: "";
      position: absolute;
      bottom: 8px;
      width: 120px;
      top: 80%;
      box-shadow: 0 16px 12px var(--shadow);
      transform: rotate(var(--r));
    }

    .loader:before {
      left: 4px;
    }

    .loader:after {
      --r: 6deg;
      right: 4px;
    }

    .loader div {
      width: 100%;
      height: 100%;
      border-radius: 13px;
      position: relative;
      z-index: 1;
      perspective: 600px;
      box-shadow: 0 4px 6px var(--shadow);
      background-image: var(--background);
    }

    .loader div ul {
      margin: 0;
      padding: 0;
      list-style: none;
      position: relative;
    }

    .loader div ul li {
      --r: 180deg;
      --o: 0;
      --c: var(--page);
      position: absolute;
      top: 10px;
      left: 10px;
      transform-origin: 100% 50%;
      color: var(--c);
      opacity: var(--o);
      transform: rotateY(var(--r));
      -webkit-animation: var(--duration) ease infinite;
      animation: var(--duration) ease infinite;
    }

    .loader div ul li:nth-child(2) {
      --c: var(--page-fold);
      -webkit-animation-name: page-2;
      animation-name: page-2;
    }

    .loader div ul li:nth-child(3) {
      --c: var(--page-fold);
      -webkit-animation-name: page-3;
      animation-name: page-3;
    }

    .loader div ul li:nth-child(4) {
      --c: var(--page-fold);
      -webkit-animation-name: page-4;
      animation-name: page-4;
    }

    .loader div ul li:nth-child(5) {
      --c: var(--page-fold);
      -webkit-animation-name: page-5;
      animation-name: page-5;
    }

    .loader div ul li svg {
      width: 90px;
      height: 120px;
      display: block;
    }

    .loader div ul li:first-child {
      --r: 0deg;
      --o: 1;
    }

    .loader div ul li:last-child {
      --o: 1;
    }

    .loader span {
      display: block;
      left: 0;
      right: 0;
      top: 100%;
      margin-top: 20px;
      text-align: center;
      color: var(--text);
    }

    @keyframes page-2 {
      0% {
        transform: rotateY(180deg);
        opacity: 0;
      }

      20% {
        opacity: 1;
      }

      35%,
      100% {
        opacity: 0;
      }

      50%,
      100% {
        transform: rotateY(0deg);
      }
    }

    @keyframes page-3 {
      15% {
        transform: rotateY(180deg);
        opacity: 0;
      }

      35% {
        opacity: 1;
      }

      50%,
      100% {
        opacity: 0;
      }

      65%,
      100% {
        transform: rotateY(0deg);
      }
    }

    @keyframes page-4 {
      30% {
        transform: rotateY(180deg);
        opacity: 0;
      }

      50% {
        opacity: 1;
      }

      65%,
      100% {
        opacity: 0;
      }

      80%,
      100% {
        transform: rotateY(0deg);
      }
    }

    @keyframes page-5 {
      45% {
        transform: rotateY(180deg);
        opacity: 0;
      }

      65% {
        opacity: 1;
      }

      80%,
      100% {
        opacity: 0;
      }

      95%,
      100% {
        transform: rotateY(0deg);
      }
    }

    #loader {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80vh;
    }

    #data-customer.form-floating>.form-control-plaintext:focus,
    .form-floating>.form-control-plaintext:not(:placeholder-shown),
    .form-floating>.form-control:focus,
    .form-floating>.form-control:not(:placeholder-shown) {
      padding-top: 2.5rem;
      padding-bottom: .625rem;
    }
  </style>
</head>

<body class="bg-light">
  <header>
    <nav class="navbar bg-primary-subtle">
      <div class="container-fluid">
        <div class="d-flex w-100 justify-content-between align-items-center">
          <a class="navbar-brand" href="#">
            <img alt="Logo" width="30" height="24" class="d-inline-block align-text-top"
              src="https://img.icons8.com/pulsar-color/96/sell.png">
            รายการขาย
          </a>
          <div class="d-none">
            <span id="profileName" class="me-2"></span>
            <img id="profilePic" src="" alt="profilePic" width="30" height="30" class="rounded-circle">
          </div>
        </div>
      </div>
    </nav>
  </header>
  <main class="mb-5">
    <section id="loader" style="display: none;">
      <div class="loader">
        <div>
          <ul>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
            <li>
              <svg fill="currentColor" viewBox="0 0 90 120">
                <path
                  d="M90,0 L90,120 L11,120 C4.92486775,120 0,115.075132 0,109 L0,11 C0,4.92486775 4.92486775,0 11,0 L90,0 Z M71.5,81 L18.5,81 C17.1192881,81 16,82.1192881 16,83.5 C16,84.8254834 17.0315359,85.9100387 18.3356243,85.9946823 L18.5,86 L71.5,86 C72.8807119,86 74,84.8807119 74,83.5 C74,82.1745166 72.9684641,81.0899613 71.6643757,81.0053177 L71.5,81 Z M71.5,57 L18.5,57 C17.1192881,57 16,58.1192881 16,59.5 C16,60.8254834 17.0315359,61.9100387 18.3356243,61.9946823 L18.5,62 L71.5,62 C72.8807119,62 74,60.8807119 74,59.5 C74,58.1192881 72.8807119,57 71.5,57 Z M71.5,33 L18.5,33 C17.1192881,33 16,34.1192881 16,35.5 C16,36.8254834 17.0315359,37.9100387 18.3356243,37.9946823 L18.5,38 L71.5,38 C72.8807119,38 74,36.8807119 74,35.5 C74,34.1192881 72.8807119,33 71.5,33 Z">
                </path>
              </svg>
            </li>
          </ul>
        </div><span>Loading</span>
      </div>
    </section>
    <section id="loginsec" class="d-none">
      <div class="container-fluid">
        <div class="row justify-content-center mt-5">
          <div class="col-md-4">
            <div class="card">
              <div class="card-header text-center h3 text-bg-primary">
                <i class="bi bi-person"></i>
                Login
              </div>
              <div class="card-body">
                <form id="loginForm">
                  <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control text-center" id="username" placeholder="Enter username"
                      autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
                  </div>
                  <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control text-center" id="password" placeholder="Enter password"
                      autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false">
                  </div>
                  <button type="submit" id="login-btn" class="btn btn-primary w-100">Login</button>
                  <div class="alert mt-3 w-100 text-center d-none" role="alert">

                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="formsec" class="d-none">
      <div class="container" style="max-width: 1200px;">
        <form id="mainform" class="needs-validation" novalidate>
          <div class="row justify-content-start align-items-start g-3 mt-2">
            <div class="col-12">
              <h3>
                <i class="bi bi-person-fill-check text-primary display-2"></i>
                บันทึกข้อมูลลูกค้า
              </h3>
            </div>
            <div class="col-md-4">
              <label for="date"><i class="bi bi-calendar-fill text-primary"></i> วันที่</label>
              <input type="date" id="date" name="date" class="form-control bg-info-subtle" readonly>
              <div class="invalid-feedback">
                กรุณากรอกวันที่
              </div>
            </div>
            <div class="col-md-4">
              <label for="sender"><i class="bi bi-person-fill text-primary"></i> ผู้ส่ง</label>
              <input type="text" id="sender" name="sender" class="form-control bg-info-subtle" readonly>
              <div class="invalid-feedback">
                กรุณากรอกผู้ส่ง
              </div>
            </div>
            <div class="col-md-4">
              <!-- branch -->
              <label for="branch"><i class="bi bi-geo-fill text-primary"></i> สาขาที่ลูกค้าสนใจ  <span
                 class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></label>
              <select class="form-select" id="branch" name="branch" required disabled>
                <option value="" selected disabled>กำลังโหลด...</option>
              </select>
              <div class="invalid-feedback">
                กรุณากรอกสาขา
              </div>
            </div>
            <div class="col-md-4">
              <!-- product -->
              <label for="product"><i class="bi bi-box-fill text-primary"></i> สินค้าที่ลูกค้าสนใจ <span
                  class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></label>
              <select class="form-select" id="product" name="product" required disabled>
                <option value="" selected disabled>กำลังโหลด...</option>
              </select>
              <div class="invalid-feedback">
                กรุณาเลือกสินค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- source -->
              <label for="source"><i class="bi bi-chat-right-text-fill text-primary"></i> แหล่งที่มา <span
                  class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></label>
              <select class="form-select" id="source" name="source" required disabled>
                <option value="" selected disabled>กำลังโหลด...</option>
              </select>
              <div class="invalid-feedback">
                กรุณาเลือกสินค้า
              </div>
            </div>
            <div class="col-12">
              <label for="remark"><i class="bi bi-chat-left-text-fill text-success"></i> หมายเหตุ</label>
              <textarea class="form-control" id="remark" name="remark" rows="3"></textarea>
            </div>
          </div>
          <!-- seperator -->
          <hr>
          <div class="row justify-content-start align-items-start g-3 mt-2">
            <div class="col-md-4">
              <!-- customer firstname -->
              <label for="customer_fname"><i class="bi bi-person-fill text-primary"></i> ชื่อลูกค้า</label>
              <input type="text" id="customer_fname" name="customer_fname" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกชื่อลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer lastname -->
              <label for="customer_lname"><i class="bi bi-person-fill text-primary"></i> นามสกุลลูกค้า</label>
              <input type="text" id="customer_lname" name="customer_lname" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกนามสกุลลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer natrion id -->
              <label for="customer_nationid"><i class="bi bi-person-fill text-primary"></i> รหัสประจำตัวประชาชน</label>
              <input type="text" id="customer_nationid" name="customer_nationid" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกรหัสประจำตัวประชาชน
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer age -->
              <label for="customer_age"><i class="bi bi-person-fill text-primary"></i> อายุ</label>
              <input type="number" id="customer_age" name="customer_age" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกอายุลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer phone -->
              <label for="customer_phone"><i class="bi bi-person-fill text-primary"></i> เบอร์โทรศัพท์</label>
              <input type="text" id="customer_phone" name="customer_phone" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกเบอร์โทรศัพท์ลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer line id -->
              <label for="customer_lineid"><i class="bi bi-line text-primary"></i></i> Line ID</label>
              <input type="text" id="customer_lineid" name="customer_lineid" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอก Line ID ลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer province -->
              <label for="customer_province"><i class="bi bi-geo-alt-fill text-primary"></i> จังหวัด <span
                  class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></label>
              <select class="form-select" id="customer_province" name="customer_province" required disabled>
                <option value="" selected disabled>กำลังโหลด...</option>
              </select>
              <div class="invalid-feedback">
                กรุณาเลือกจังหวัด
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer occupation -->
              <label for="customer_occupation"><i class="bi bi-person-fill text-primary"></i> อาชีพ</label>
              <input type="text" id="customer_occupation" name="customer_occupation" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกอาชีพลูกค้า
              </div>
            </div>
            <div class="col-md-4">
              <!-- customer down payment -->
              <label for="customer_downpayment"><i class="bi bi-person-fill text-primary"></i> งบเงินดาวน์</label>
              <input type="number" id="customer_downpayment" name="customer_downpayment" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกงบเงินดาวน์
              </div>
            </div>

            <div class="col-md-4">
              <!-- status -->
              <label for="status"><i class="bi bi-person-fill text-primary"></i> สถานะ <span
                  class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span></label>
              <select class="form-select" id="status" name="status" required disabled>
                <option value="" selected disabled>กำลังโหลด...</option>
              </select>
            </div>
            <div class="col-12 text-center">
              <button type="submit" class="btn btn-lg btn-primary"><i class="bi bi-save"></i> บันทึกข้อมูล</button>
            </div>
          </div>
        </form>
        <form id="responseform" class="needs-validation d-none" novalidate>
          <!-- response_status, close_price, contract_no, close_date, seller -->
          <div class="row justify-content-start align-items-start g-3 mt-2">
            <div class="col-12">
              <h3>
                <i class="bi bi-person-fill-check text-success display-2"></i>
                บันทึกข้อมูลการขาย
              </h3>
            </div>
            <div class="col-md-4">
              <div class="form-floating mb-3">
                <input type="text" id="data-date" name="data-date" class="form-control" readonly>
                <label for="data-date"><i class="bi bi-calendar-fill text-success"></i> วันที่</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating mb-3">
                <input type="text" id="data-sender" name="data-sender" class="form-control" readonly>
                <label for="data-sender"><i class="bi bi-person-fill text-success"></i> ผู้ส่ง</label>
              </div>
            </div>
            <div class="col-md-4">
              <!-- branch -->
              <div class="form-floating mb-3">
                <input type="text" id="data-branch" name="data-branch" class="form-control" readonly>
                <label for="data-branch"><i class="bi bi-geo-fill text-success"></i> สาขาที่ลูกค้าสนใจ</label>
              </div>
            </div>
            <div class="col-md-4">
              <!-- product -->
              <div class="form-floating mb-3">
                <input type="text" id="data-product" name="data-product" class="form-control" readonly>
                <label for="data-product"><i class="bi bi-box-fill text-success"></i> สินค้าที่ลูกค้าสนใจ</label>
              </div>
            </div>
            <div class="col-md-4">
              <!-- source -->
              <div class="form-floating mb-3">
                <input type="text" id="data-source" name="data-source" class="form-control" readonly>
                <label for="data-source"><i class="bi bi-chat-right-text-fill text-success"></i> แหล่งที่มา</label>
              </div>
            </div>
            <div class="col-12">
              <!-- remark -->
              <div class="form-floating mb-3">
                <textarea type="text" id="data-remark" name="data-remark" class="form-control" readonly></textarea>
                <label for="data-remark"><i class="bi bi-chat-left-text-fill text-success"></i> หมายเหตุ</label>
              </div>
            </div>
            <div class="col-12">
              <!-- customer firstname -->
              <div class="form-floating mb-3">
                <textarea type="text" id="data-customer" name="data-customer"
                  style="height: 15rem; line-height: 1.5rem;" class="form-control" readonly></textarea>
                <label for="data-customer"><i class="bi bi-person-fill text-success"></i> ข้อมูลลูกค้า</label>
              </div>
            </div>
          </div>
          <!-- seperator -->
          <hr>
          <div class="row justify-content-start align-items-start g-3 mt-2">
            <div class="col-md-4">
              <!-- response_status -->
              <label for="response_status"><i class="bi bi-bar-chart-steps text-success"></i> สถานะ</label>
              <select class="form-select" id="response_status" name="status" required></select>
              <div class="invalid-feedback">
                กรุณาเลือกสถานะการขาย
              </div>
            </div>
            <div class="col-md-4">
              <!-- sell_price -->
              <label for="sell_price"><i class="bi bi-tags-fill text-success"></i> ราคาขาย</label>
              <input type="number" id="sell_price" name="sell_price" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกราคาปิด
              </div>
            </div>
            <div class="col-md-4">
              <!-- contract_no -->
              <label for="contract_no"><i class="bi bi-file-earmark-fill text-success"></i> เลขที่สัญญา</label>
              <input type="text" id="contract_no" name="contract_no" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกเลขที่สัญญา
              </div>
            </div>
            <div class="col-md-4">
              <!-- close_date -->
              <label for="close_date"><i class="bi bi-calendar-check-fill text-success"></i> วันที่ปิด</label>
              <input type="date" id="close_date" name="close_date" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกวันที่ปิด
              </div>
            </div>
            <div class="col-md-4">
              <!-- seller -->
              <label for="seller"><i class="bi bi-person-fill text-success"></i> ผู้ขาย</label>
              <input type="text" id="seller" name="seller" class="form-control" required>
              <div class="invalid-feedback">
                กรุณากรอกผู้ขาย
              </div>
            </div>
            <input type="hidden" name="wid" id="wid">
            <div class="col-12 text-center">
              <button type="submit" class="btn btn-lg btn-success"><i class="bi bi-save"></i> บันทึกข้อมูล</button>
            </div>
          </div>
        </form>
      </div>
    </section>
  </main>
  <script>
    // const scriptURL = 'https://script.google.com/macros/s/AKfycbwwObU8btQb_5pY-uZMWXspsy4voQ62hSuIWVgHjWoR_T0ZXszH_VLHR7Fy9df8DQol/exec'
    // const liffId = '2006601191-QGe1GayY'
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzvGpjEOghikFBNNvbbiZ3mXpWQHVlyuYgoZJTfAO_rhGA5sVGufgCuk-_ooP4kj30/exec'
    const liffId = '1655873446-MpmBPPzl'
    $(document).ready(function () {
      liff.init({ liffId })
      liff.ready.then(() => {
        if (!liff.isLoggedIn()) {
          liff.login()
        }
        loadDropDown()
        if (new URLSearchParams(window.location.search).get('wid') == null) {
          $('#customer_province').select2({
            theme: 'bootstrap-5',
            placeholder: 'เลือกจังหวัด',
            allowClear: true
          })
        } else {
          $('nav').removeClass('bg-primary-subtle').addClass('bg-success-subtle')
          $('.loader').css({
            '--background': 'linear-gradient(90deg, #28a745 0%, #28a745 100%)',
            '--shadow': 'rgba(40, 167, 69, 0.28)',
            '--text': '#6C7486',
            '--page': 'rgba(255, 255, 255, 0.36)',
            '--page-fold': 'rgba(255, 255, 255, 0.52)',

          })
        }
        $('#loader').show()
        liff.getProfile().then(profile => {
          $('#profileName').text(profile.displayName)
          $('#profilePic').attr('src', profile.pictureUrl).parent().addClass('animate__animated animate__slideInRight').removeClass('d-none')
        })
        let user = JSON.parse(localStorage.getItem('user'))
        if (user) {
          if (user.expire < new Date().getTime()) {
            $('#loader').hide()
            localStorage.removeItem('user')
            $('#loginsec').removeClass('d-none')
            $('#formsec').addClass('d-none')
          } else {
            $('#loginsec').remove()
            showForm(user)
          }
        } else {
          $('#loader').hide()
          $('#loginsec').removeClass('d-none')
          $('#formsec').addClass('d-none')
        }
      })
      $('#date').val(new Date().toISOString().split('T')[0])
      $('#username').focus()
      $('#username, #password').keyup(function (e) {
        if (e.keyCode == 13) {
          $('#loginForm').submit()
        }
      })

    })

    function showForm(user) {
      console.log("🚀 ~ showForm ~ user:", user)
      let wid = new URLSearchParams(window.location.search).get('wid')
      if (wid == null) {
        $('#loader').hide()
        $('#formsec').addClass('animate__animated animate__slideInDown animate__faster').removeClass('d-none')
        $('#sender').val(user.name)
        $('#branch').val(user.branch)
        return
      }
      $(document).prop('title', 'อัพเดทข้อมูลใบงาน ' + wid)
      $('.navbar-brand').html($('.navbar-brand').html() + ' - อัพเดทข้อมูลใบงาน ' + wid)
      $('#loader').show()
      $('#wid').val(wid)
      $.post(scriptURL, { action: 'getUpdateData', wid: wid, role: user.role, branch: user.branch }, function (res) {
        console.log("🚀 ~ res:", res)
        $('#loader').hide()
        if (res.status == 'notfound') {
          Swal.fire({
            icon: 'error',
            title: 'ไม่พบข้อมูล',
            text: res.text,
            confirmButtonText: 'ตกลง'
          }).then(() => {
            $('#body').html('<h1 class="text-center">ไม่พบข้อมูล</h1>').addClass('d-flex justify-content-center align-items-center').css('height', '80vh')
            liff.closeWindow()
          })
          return
        }
        if (res.status == 'noauth') {
          $('#response_status').parents('.row').remove()
          Swal.fire({
            icon: 'error',
            title: 'ไม่สามารถอัพเดทข้อมูลได้',
            text: res.text,
            confirmButtonText: 'ตกลง'
          })
        }
        let data = res.data
        $('#formsec').addClass('animate__animated animate__slideInDown animate__faster').removeClass('d-none')
        $('#mainform').remove()
        $('#data-date').val(data.date)
        $('#data-sender').val(data.sender)
        $('#data-branch').val(data.branch)
        $('#data-product').val(data.product)
        $('#data-source').val(data.source)
        $('#data-remark').val(data.remark)
        $('#seller').val(data.seller).attr('readonly', res.status != 'success')
        $('#sell_price').val(data.sell_price).attr('readonly', res.status != 'success')
        $('#contract_no').val(data.contract_no).attr('readonly', res.status != 'success')
        $('#close_date').val(data.close_date).attr('readonly', res.status != 'success')

        let customer = `ชื่อ: ${data.customer.fname} ${data.customer.lname} 
อายุ: ${data.customer.age} ปี
โทร: ${data.customer.phone}
Line: ${data.customer.lineid}
จังหวัด: ${data.customer.province}
อาชีพ: ${data.customer.occupation}
งบเงินดาวน์: ${Number(data.customer.downpayment).toLocaleString()} บาท`
        $('#data-customer').val(customer)
        $('#seller').val(user.name)
        $('#responseform').removeClass('d-none')
        let waitoption = setInterval(() => {
          if ($('#response_status').hasClass('select2-hidden-accessible')) {
            $('#response_status').val(data.status).trigger('change')
            clearInterval(waitoption)
          } else {
            $('#response_status').attr('data-status', data.status)
          }
        },1000)
      })
    }
    function loadDropDown() {
      $.post(scriptURL, { action: 'getDropdown' }, function (data) {
        ['source', 'product', 'status', 'customer_province', 'branch'].forEach(item => {
          let select = $('[name="' + item + '"]')
          select.prop('disabled', false).parent().find('.spinner-border').remove()
          select.empty()
          select.append('<option value="" selected disabled>กำลังโหลด...</option>')
          data[item].forEach(item => {
            select.append(`<option value="${item}">${item}</option>`)
          })
          select.select2({
            theme: 'bootstrap-5',
            placeholder: `เลือก${$('label[for="' + item + '"]').text().trim()}`,
            allowClear: true
          })
        })
        $('#status').val(
          new URLSearchParams(window.location.search).get('wid') == null ? data.status[0] : $('#status').attr('data-status')
        ).trigger('change')
      })
    }
    $('#loginForm').submit(function (e) {
      e.preventDefault()
      let u = $('#username').val()
      let p = $('#password').val()
      if (username == '' || password == '') {
        $('.alert').addClass('alert-danger').removeClass('d-none').html('<i class="bi bi-exclamation-triangle"></i> กรุณากรอกข้อมูลให้ครบ')
        return
      }
      $('#login-btn').addClass('pe-none').html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> กำลังเข้าสู่ระบบ...')
      $.post(scriptURL, { action: 'login', u, p }, function (res) {
        console.log("🚀 ~ res:", res)
        if (res.status == 'success') {
          $('#loginsec').remove()
          showForm(res)
          localStorage.setItem('user', JSON.stringify({
            name: res.name,
            branch: res.branch,
            uuid: res.uuid,
            role: res.role,
            expire: new Date().getTime() + (1000 * 60 * 60)
          }))
        } else {
          $('#login-btn').removeClass('pe-none').html('Login')
          $('.alert').addClass('alert-danger').removeClass('d-none').html('<i class="bi bi-exclamation-triangle"></i> ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง')
        }
      })
    })

    function submitForm() {
      let user = JSON.parse(localStorage.getItem('user'))
      if (!user || !user.uuid) {
        localStorage.removeItem('user')
        location.reload()
      }
      let data = $('#mainform').serializeArray().reduce((obj, item) => {
        obj[item.name] = item.value
        return obj
      }, {})
      data.action = 'saveData'
      data.uuid = user.uuid
      console.log(data);
      Swal.fire({
        icon: 'info',
        title: 'กำลังบันทึกข้อมูล...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading()
        }
      })
      $.post(scriptURL, data, function (res) {
        if (res.status == 'success') {
          Swal.fire({
            icon: 'success',
            title: 'บันทึกข้อมูลสำเร็จ',
            showConfirmButton: false,
            timer: 1500
          }).then(() => {
            location.reload()
          })
        } else {
          Swal.fire({
            icon: 'error',
            title: 'บันทึกข้อมูลไม่สำเร็จ',
            text: res.message
          })
        }
      })
    }

    function submitResponse() {
      let user = JSON.parse(localStorage.getItem('user'))
      if (!user || !user.uuid) {
        localStorage.removeItem('user')
        location.reload()
      }
      let data = $('#responseform').serializeArray().reduce((obj, item) => {
        obj[item.name] = item.value
        return obj
      }, {})
      data.action = 'saveResponse'
      data.uuid = user.uuid
      data.wid = $('#wid').val()
      console.log(data);
      Swal.fire({
        icon: 'info',
        title: 'กำลังบันทึกข้อมูล...',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading()
        }
      })
      $.post(scriptURL, data, function (res) {
        if (res.status == 'success') {
          Swal.fire({
            icon: 'success',
            title: 'บันทึกข้อมูลสำเร็จ',
            showConfirmButton: false,
            timer: 1500
          }).then(() => {
            $('main').html('<div class="alert alert-primary text-center h2" role="alert"><i class="bi bi-check-circle"></i> บันทึกข้อมูลสำเร็จ</div>').addClass('d-flex justify-content-center align-items-center').css('min-height', '80vh')
            $('nav').removeClass('bg-success-subtle').addClass('bg-primary-subtle')
          })
        } else {
          Swal.fire({
            icon: 'error',
            title: 'บันทึกข้อมูลไม่สำเร็จ',
            text: res.message
          })
        }
      })
    }
  </script>
  <script>
    (() => {
      'use strict'

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      const forms = document.querySelectorAll('.needs-validation')

      // Loop over them and prevent submission
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          event.preventDefault()
          if (!form.checkValidity()) {
            event.stopPropagation()
            form.classList.add('was-validated')
            $(form).find(':invalid').first().focus()
          } else {
            if (form.id == 'mainform') return submitForm()
            if (form.id == 'responseform') return submitResponse()
          }

        }, false)
      })
    })()
  </script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/v/bs5/dt-2.1.8/date-1.5.4/r-3.0.3/rg-1.5.1/datatables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>

</html>
<!DOCTYPE html>
<html lang="en">

</html>

<head>
    <!-- no cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- no cache -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตรวจสอบห้องว่างและราคา</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Add Flatpickr for date picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
   
    <style>
        :root {
            --primary-color: #8e784f;
            --primary-dark: #70603e;
            --primary-light: #a99063;
            --primary-ultra-light: #f5f1ea;
            --secondary-color: #465362;
            --secondary-dark: #313c4e;
            --accent-color: #d8b26e;
            --success-color: #5aa786;
            --warning-color: #e6b86a;
            --danger-color: #cc6b5a;
            --light-color: #f8f9fa;
            --dark-color: #231f20;
            --text-color: #333333;
            --text-muted: #6c757d;
            --border-color: #e9e2d0;
            --border-radius: 10px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        * {
            font-family: 'Mitr', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color: var(--text-color);
        }

        body {
            background-color: #f8f9fa;
            background-image: linear-gradient(135deg, rgba(142, 120, 79, 0.03) 0%, rgba(216, 178, 110, 0.03) 100%);
        }

        .booking-container {
            max-width: 800px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .header {
            background-color: var(--primary-color);
            background-image: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 20px 0;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        .header h1,
        .header span {
            color: white;
        }

        .hotel-logo {
            width: 100px;
            height: 100px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .form-label {
            font-weight: 500;
            color: var(--secondary-color);
        }

        .date-picker-container {
            background-color: var(--primary-ultra-light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 0.2rem rgba(142, 120, 79, 0.2);
        }

        .input-group-text {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .input-group-text i {
            color: white;
        }

        .room-option {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .room-option:hover {
            box-shadow: var(--box-shadow);
            transform: translateY(-3px);
        }

        .room-option.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-ultra-light);
        }

        .room-option img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 5px;
        }

        .booking-summary {
            background-color: var(--primary-ultra-light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-top: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .btn-book {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            padding: 10px 25px;
            border-radius: 5px;
            border: none;
            transition: all 0.2s ease;
        }

        .btn-book:hover {
            background-color: var(--primary-dark);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .check-booking-link {
            display: inline-block;
            margin-top: 10px;
            color: var(--primary-color);
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .check-booking-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* Availability Badge Styling */
        .availability-badge {
            background-color: rgba(70, 83, 98, 0.1);
            color: var(--secondary-color);
            border-left: 4px solid var(--primary-color);
            padding: 12px 16px;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        #available-rooms-count {
            color: var(--primary-color);
            font-size: 18px;
            font-weight: 700;
        }

        /* Carousel custom styling */
        .carousel {
            box-shadow: var(--box-shadow);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .carousel-item img {
            height: 300px;
            object-fit: cover;
        }

        .carousel-caption {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 10px;
            bottom: 20px;
        }

        .carousel-indicators [data-bs-target] {
            background-color: var(--primary-color);
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.5));
        }

        /* Color text-primary to match our theme */
        .text-primary {
            color: var(--primary-color) !important;
        }

        .bg-primary {
            background-color: var(--primary-color) !important;
        }

        /* Icon styling */
        .bi {
            color: var(--primary-color);
        }

        h3,
        h4,
        h5 {
            color: var(--secondary-color);
        }

        /* Media queries */
        @media screen and (min-width: 1201px) {
            .header h1 {
                font-size: 2.2rem;
            }

            .hotel-logo {
                width: 120px;
                height: 120px;
            }
        }
        @media screen and (max-width: 1200px) {
            .header h1 {
                font-size: 2rem;
            }

            .hotel-logo {
                width: 90px;
                height: 90px;
            }
        }
        @media screen and (max-width: 992px) {
            .header h1 {
                font-size: 1.6rem;
            }

            .hotel-logo {
                width: 60px;
                height: 60px;
            }
        }

        @media screen and (max-width: 576px) {
            .header h1 {
                font-size: 1.4rem;
            }

            .hotel-logo {
                width: 50px;
                height: 50px;
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        #nprogress .bar{
            height: 3px !important;
        }
    </style>

</head>

<body>
    <div class="row align-items-center justify-content-center p-2">
        <div class="col-md-6">
            <div class="booking-container my-4 my-md-2 p-3 p-md-4">
                <div class="header">
                    <div class="d-flex align-items-center justify-content-center p-2">
                        <img src="https://img5.pic.in.th/file/secure-sv1/Asset-4f4db280d314ea126.png" alt="Hotel Logo"
                            class="hotel-logo me-2">
                        <div>
                            <h1>ตรวจสอบห้องว่างและราคา</h1>
                            <span>ค้นหาและจองที่พักที่สมบูรณ์แบบสำหรับคุณ</span>
                        </div>
                    </div>
                </div>

                <!-- Ads Carousel -->
                <div id="adsCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#adsCarousel" data-bs-slide-to="0" class="active"
                            aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#adsCarousel" data-bs-slide-to="1"
                            aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#adsCarousel" data-bs-slide-to="2"
                            aria-label="Slide 3"></button>
                        <button type="button" data-bs-target="#adsCarousel" data-bs-slide-to="3"
                            aria-label="Slide 4"></button>
                    </div>
                    <!-- https://img2.pic.in.th/pic/30ba58d5-91ba-44cd-8ee5-1dd666b18703.jpg
      https://img5.pic.in.th/file/secure-sv1/910c66b9-4972-46a7-9f27-2d9375b789b8.jpg
      https://img2.pic.in.th/pic/a7b203ad-a107-4d5c-a371-55f2859dee75.jpg
      https://img5.pic.in.th/file/secure-sv1/d07141fe-f7cc-4f00-b5c0-c3e804aa6725.jpg -->
                    <div class="carousel-inner rounded">
                        <div class="carousel-item active">
                            <img src="https://img2.pic.in.th/pic/30ba58d5-91ba-44cd-8ee5-1dd666b18703.jpg"
                                class="d-block w-100" alt="Special Promotion">
                            <!-- <div class="carousel-caption d-none d-md-block">
                              <h5>พิเศษ! จองห้องพัก 2 คืนขึ้นไป ลด 20%</h5>
                              <p>เมื่อจองผ่านเว็บไซต์โดยตรง ถึง 30 เมษายน 2025</p>
                          </div> -->
                        </div>
                        <div class="carousel-item">
                            <img src="https://img5.pic.in.th/file/secure-sv1/910c66b9-4972-46a7-9f27-2d9375b789b8.jpg"
                                class="d-block w-100" alt="Restaurant Promotion">
                        </div>
                        <div class="carousel-item">
                            <img src="https://img2.pic.in.th/pic/a7b203ad-a107-4d5c-a371-55f2859dee75.jpg"
                                class="d-block w-100" alt="Spa Promotion">
                        </div>
                        <div class="carousel-item">
                            <img src="https://img5.pic.in.th/file/secure-sv1/d07141fe-f7cc-4f00-b5c0-c3e804aa6725.jpg"
                                class="d-block w-100" alt="Spa2 Promotion">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#adsCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#adsCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
                <div class="my-2 d-flex justify-content-end">
                    <div>
                        <a href="check-booking.html" class="check-booking-link">
                            <i class="bi bi-search me-1"></i> ตรวจสอบสถานะการจอง
                        </a>
                    </div>

                </div>

                <form id="checkAvailabilityForm" class="mb-4">
                    <!-- Date Selection Section -->
                    <div class="date-picker-container">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="checkInDate"> วันที่เข้าพัก</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                                    <input type="text" class="form-control" id="checkInDate"
                                        placeholder="Select check-in date" required>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="checkOutDate"> วันที่ออก</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                                    <input type="text" class="form-control" id="checkOutDate"
                                        placeholder="Select check-out date" required>
                                </div>
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="roomQuantity">จำนวนห้อง</label>
                                <select class="form-select" id="roomQuantity" required>
                                    <option value="1" selected>1 ห้อง</option>
                                    <option value="2">2 ห้อง</option>
                                    <option value="3">3 ห้อง</option>
                                    <option value="4">4 ห้อง</option>
                                    <option value="5">5 ห้อง</option>
                                    <option value="6">6 ห้อง</option>
                                    <option value="7">7 ห้อง</option>
                                    <option value="8">8 ห้อง</option>
                                    <option value="9">9 ห้อง</option>
                                    <option value="10">10 ห้อง</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="adults">ผู้ใหญ่</label>
                                <select class="form-select" id="adults" required>
                                    <option value="1">1 คน</option>
                                    <option value="2" selected>2 คน</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="children">เด็ก</label>
                                <select class="form-select" id="children">
                                    <option value="0" selected>0 คน</option>
                                </select>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-book" id="checkAvailabilityBtn">
                                <i class="bi bi-search me-2"></i>ตรวจสอบห้องว่าง
                            </button>
                        </div>
                    </div>
                </form>
                <!-- Availability Status Section -->
                <form id="bookingForm" style="display: none;">
                    <!-- Room Selection Section -->
                    <div class="row">
                        <h3 class="mb-3">ข้อมูลห้องพัก</h3>
                        <div class="col-12">
                            <div id="availability-status" class="availability-badge my-2 h4" style="display: none;">
                                <strong>ห้องพักว่าง:</strong> <span id="available-rooms-count">0</span> ห้อง
                            </div>
                        </div>
                        <template id="roomTemplate">
                            <div class="mx-auto mb-3">
                                <div class="room-option selected" data-room-type="standard" data-price="{{price}}">
                                    <img src="{{image}}" alt="{{roomType}}">
                                    <p class="text-muted small">{{description}}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="fw-bold">฿{{price}} / คืน</span>
                                        <span class="badge bg-primary">{{available}} ห้องว่าง</span>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <div class="col-12 mt-2" id="roomOptions">
                            <!-- Room options will be dynamically generated here -->

                        </div>
                    </div>

                    <!-- Guest Information Section -->
                    <h3 class="mb-3 mt-4">ข้อมูลผู้เข้าพัก</h3>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="firstName">ชื่อ</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lastName">นามสกุล</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="email">อีเมล์</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="phone">เบอร์โทรศัพท์</label>
                            <input type="tel" class="form-control" id="phone" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label for="specialRequests">คำขอพิเศษ (ไม่จำเป็น)</label>
                            <textarea class="form-control" id="specialRequests" rows="3"></textarea>
                        </div>
                    </div>

                    <!-- Booking Summary Section -->
                    <div id="bookingSummary" class="booking-summary mb-4" style="display: none;">
                        <h4 class="mb-3">สรุปการจอง</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>วันเข้าพัก :</strong> <span id="summaryCheckIn"></span></p>
                                <p><strong>วันออก :</strong> <span id="summaryCheckOut"></span></p>
                                <p><strong>รวมวันเข้าพัก :</strong> <span id="summaryNights"></span></p>
                                <p><strong>จำนวนห้อง :</strong> <span id="summaryRoomQuantity"></span></p>
                                <p><strong>ผู้เข้าพัก :</strong> <span id="summaryGuests"></span></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>ราคา / คืน :</strong> <span id="summaryPrice"></span></p>
                                <p><strong>ราคารวม :</strong> <span id="summaryTotal"
                                        class="fw-bold text-danger"></span></p>
                            </div>
                            <div class="col-12">
                                <div class="special-request mt-2">
                                    <p><strong>คำขอพิเศษ :</strong></p>
                                    <p id="summarySpecialRequest" class="bg-light p-2 rounded small fst-italic">ไม่มี
                                    </p>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- Google reCAPTCHA -->
                    <div class="d-flex justify-content-center mb-3">
                        <div class="g-recaptcha mb-3" data-sitekey="6Lcy0hwrAAAAAIzb4Mv8oiw5eiJvAQ55H_3xGOOg"
                            data-callback="onRecaptchaSuccess"></div>
                    </div>
                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-book rounded-2" style="display: none;">
                            จองเลย
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>
    <script>
        // Google Apps Script Web App URL - replace with your actual deployed web app URL
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzqS2yBlpOE7IVtx856bOPAxQ1ZzDk6wMk8PipwH067xmj-bKcOjJb5fBTm_kkz5KDWRg/exec";

        // Automatically select the standard room (the only room type)
        const RoomOptions = {
            type: "standard",
            price: 1200,
            available: 0 // Will be updated from Google Sheets
        };

        // Update booking summary immediately to show default selection
        document.addEventListener('DOMContentLoaded', function () {
            NProgress.start();
            NProgress.inc()
            // Initialize date pickers
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            moment.locale('th');

            const checkInPicker = flatpickr("#checkInDate", {
                minDate: "today",
                dateFormat: "Y-m-d",
                defaultDate: today,
                locale: "th",
                onChange: function (selectedDates, dateStr) {
                    // When check-in date changes, update check-out date minimum
                    const nextDay = moment(dateStr, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');
                    const checkOutDate = checkOutPicker.selectedDates[0];

                    // Set minimum check-out date to the day after check-in
                    checkOutPicker.set('minDate', nextDay);

                    // If current check-out date is before new check-in date, update it
                    if (moment(checkOutDate, 'YYYY-MM-DD').isBefore(nextDay)) {
                        checkOutPicker.setDate(nextDay);
                    }

                }
            });

            const checkOutPicker = flatpickr("#checkOutDate", {
                minDate: tomorrow,
                dateFormat: "Y-m-d",
                defaultDate: tomorrow,
                locale: "th"
            });

            $('#specialRequests').on('input', function () {
                updateBookingSummary();
            });
        });

        window.addEventListener('load', function () {
            NProgress.done();
        });

        document.getElementById('roomQuantity').addEventListener('change', function () {
            const selectedRoomQuantity = parseInt(this.value);
            const adultsSelect = document.getElementById('adults');
            const childrenSelect = document.getElementById('children');

            let adult = parseInt(adultsSelect.value);
            let child = parseInt(childrenSelect.value);
            // Clear previous options
            adultsSelect.innerHTML = '';
            childrenSelect.innerHTML = '';

            // Populate adults and children select options based on room quantity
            let maxPerRoom = 2; // Default max adults per room

            for (let i = 0; i <= selectedRoomQuantity * maxPerRoom; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + ' ' + 'คน'
                childrenSelect.appendChild(option.cloneNode(true));
                if (1 === 0) continue
                adultsSelect.appendChild(option);
            }
            adultsSelect.value = adult > selectedRoomQuantity * maxPerRoom ? selectedRoomQuantity * maxPerRoom : adult;
            childrenSelect.value = child > selectedRoomQuantity * maxPerRoom ? selectedRoomQuantity * maxPerRoom : child;

        });

        // Handle availability check form submission
        document.getElementById('checkAvailabilityForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const checkInDate = $('#checkInDate').val();
            const checkOutDate = $('#checkOutDate').val();
            const roomQuantity = $('#roomQuantity').val();

            if (!checkInDate || !checkOutDate) {
                Swal.fire({
                    icon: 'error',
                    title: 'กรุณาเลือกวันที่',
                    text: 'กรุณาเลือกวันที่เข้าพักและวันที่ออก',
                    confirmButtonText: 'ตกลง',
                    customClass: { popup: 'rounded-3' }
                });
                return;
            }

            // Show loading state
            Swal.fire({
                icon: 'info',
                title: 'กำลังตรวจสอบห้องว่าง...',
                text: 'กรุณารอสักครู่',
                allowOutsideClick: false,
                customClass: { popup: 'rounded-3' },
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            console.log('checkInDate:', checkInDate);
            console.log('checkOutDate:', checkOutDate);
            console.log('roomQuantity:', roomQuantity);

            // Call the Google Apps Script to check availability
            checkAvailability(checkInDate, checkOutDate, roomQuantity);
        });

        // Function to check availability using Google Apps Script
        function checkAvailability(checkInDate, checkOutDate, roomQuantity) {
            // Prepare the data to send to Google Apps Script
            const data = {
                action: 'checkAvailability',
                checkInDate: checkInDate,
                checkOutDate: checkOutDate,
                roomQuantity: roomQuantity,
            };

            // Make the AJAX request to Google Apps Script
            NProgress.start();
            NProgress.inc()
            $.ajax({
                url: GOOGLE_SCRIPT_URL,
                method: 'GET',
                data: data,
                dataType: 'jsonp',
                success: function (response) {
                    Swal.close(); // Close loading dialog
                    // Check if the response is valid

                    if (response && response.success) {
                        console.log('Response:', response);
                        // Update available rooms count
                        RoomOptions.available = response.availableRooms || 0;
                        RoomOptions.price = response.roomPrice || 0;
                        RoomOptions.type = response.roomType || 'Standard Room';
                        RoomOptions.description = response.roomDescription || 'Standard Room with all amenities';

                        if (RoomOptions.available > 0) {
                            // Show availability status
                            $('#available-rooms-count').text(RoomOptions.available);


                            // Show booking form
                            $('#bookingForm').fadeIn(500);

                            // Render room options
                            renderRoomOptions();

                            // Update booking summary
                            updateBookingSummary();

                            // Scroll to booking form
                            $('html, body').animate({
                                scrollTop: $('#bookingForm').offset().top - 20
                            }, 500);


                            // Ensure the availability status is visible after scrolling
                            setTimeout(() => {
                                $('#availability-status').addClass('animate__animated animate__slideInRight');
                                $('#availability-status').show();
                                setTimeout(() => {
                                    $('#availability-status').removeClass('animate__animated animate__slideInRight');
                                }, 1000);
                            }, 1000);
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'ไม่มีห้องว่าง',
                                text: 'ขออภัย ไม่มีห้องว่างในช่วงวันที่คุณเลือก',
                                confirmButtonText: 'ตกลง',
                                customClass: { popup: 'rounded-3' }
                            });
                        }
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: response.message || 'ไม่สามารถตรวจสอบห้องว่างได้ กรุณาลองอีกครั้ง',
                            confirmButtonText: 'ตกลง',
                            customClass: { popup: 'rounded-3' }
                        });
                    }
                },
                error: function () {
                    Swal.close(); // Close loading dialog

                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้ กรุณาลองอีกครั้ง',
                        confirmButtonText: 'ตกลง',
                        customClass: { popup: 'rounded-3' }
                    });
                },
                complete: function () {
                    NProgress.done();
                }
            });
        }

        // Update booking summary
        function updateBookingSummary() {
            const checkInDate = $('#checkInDate').val();
            const checkOutDate = $('#checkOutDate').val();
            const specialRequests = $('#specialRequests').val();
            const roomQuantity = $('#roomQuantity').val();

            if (!checkInDate || !checkOutDate) {
                return;
            }

            // Calculate number of nights
            const timeDiff = moment(checkOutDate).diff(moment(checkInDate));
            const nights = Math.ceil(timeDiff / (1000 * 3600 * 24));

            // Set values in summary
            $('#summaryCheckIn').text(moment(checkInDate).format('YYYY-MM-DD'));
            $('#summaryCheckOut').text(moment(checkOutDate).format('YYYY-MM-DD'));
            $('#summaryNights').text(nights + ' คืน');

            $('#summaryGuests').text(
                $('#adults').val() + ' ผู้ใหญ่, ' +
                $('#children').val() + ' เด็ก'
            );
            $('#summaryRoomQuantity').text(roomQuantity + ' ห้อง');
            $('#summaryPrice').text('฿' + RoomOptions.price.toLocaleString());
            $('#summaryTotal').text('฿' + (RoomOptions.price * nights).toLocaleString());

            // Update special requests section
            if (specialRequests && specialRequests.trim() !== '') {
                $('#summarySpecialRequest').text(specialRequests);
            } else {
                $('#summarySpecialRequest').text('ไม่มี');
            }

            // Show summary
            $('#bookingSummary').show();
        }

        // Render room options
        function renderRoomOptions() {
            const roomTemplate = $('#roomTemplate')
            const roomContainer = $('#roomOptions');

            // Clear existing room options
            roomContainer.empty();

            let roomCard = roomTemplate.html();
            roomCard = roomCard.replace(/{{roomType}}/g, RoomOptions.type);
            roomCard = roomCard.replace(/{{price}}/g, RoomOptions.price.toLocaleString());
            roomCard = roomCard.replace(/{{available}}/g, RoomOptions.available);
            roomCard = roomCard.replace(/{{image}}/g, "https://img2.pic.in.th/pic/30ba58d5-91ba-44cd-8ee5-1dd666b18703.jpg");
            roomCard = roomCard.replace(/{{description}}/g, RoomOptions.description);
            roomContainer.append(roomCard);
        }

        // Handle booking form submission
        document.getElementById('bookingForm').addEventListener('submit', function (e) {
            e.preventDefault();
            if (!verifyRecaptcha()) {
                Swal.fire({
                    icon: 'error',
                    title: 'การยืนยันล้มเหลว',
                    text: 'กรุณายืนยันตัวตนด้วย reCAPTCHA',
                    confirmButtonText: 'ตกลง',
                    customClass: { popup: 'rounded-3' }
                });
                return;
            }

            // Show loading state
            Swal.fire({
                title: 'กำลังดำเนินการจอง...',
                text: 'กรุณารอสักครู่',
                allowOutsideClick: false,
                customClass: { popup: 'rounded-3' },
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            let stay = moment($('#checkOutDate').val(), 'YYYY-MM-DD').diff(moment($('#checkInDate').val(), 'YYYY-MM-DD'), 'days');
            console.log('stay:', stay);
            if (stay < 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'วันที่ไม่ถูกต้อง',
                    text: 'กรุณาเลือกวันที่เข้าพักและวันที่ออกให้ถูกต้อง',
                    confirmButtonText: 'ตกลง',
                    customClass: { popup: 'rounded-3' }
                });
                return;
            }

            const formData = {
                action: 'createBooking',
                checkInDate: $('#checkInDate').val(),
                checkOutDate: $('#checkOutDate').val(),
                adults: $('#adults').val(),
                children: $('#children').val(),
                firstName: $('#firstName').val(),
                lastName: $('#lastName').val(),
                email: $('#email').val(),
                phone: $('#phone').val(),
                specialRequests: $('#specialRequests').val(),
                roomQuantity: $('#roomQuantity').val(),
                stay: stay,
                'g-recaptcha-response': grecaptcha.getResponse(),
                'check-booking-endpoint': location.href.replace('/index.html', '/check-booking.html')
            };

            // Make the AJAX request to Google Apps Script to create the booking
            NProgress.start();
            NProgress.inc()
            $.ajax({
                url: GOOGLE_SCRIPT_URL,
                method: 'POST',
                data: formData,
                success: function (response) {
                    Swal.close(); // Close loading dialog

                    if (response && response.success) {
                        // Show success message with booking ID
                        Swal.fire({
                            icon: 'success',
                            title: 'จองสำเร็จ!',
                            html: `
                                <p>หมายเลขการจองของคุณคือ: <strong>${response.bookingId}</strong></p>
                                <p>เราได้ส่งรายละเอียดการจองไปยังอีเมล์ของคุณแล้ว</p>
                            `,
                            confirmButtonText: 'ตกลง',
                            customClass: { popup: 'rounded-3' }
                        }).then((result) => {
                            // Redirect to check booking page with the booking ID
                            window.location.href = `check-booking.html?id=${response.bookingId}`;
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: response.message || 'ไม่สามารถทำการจองได้ กรุณาลองอีกครั้ง',
                            confirmButtonText: 'ตกลง',
                            customClass: { popup: 'rounded-3' }
                        });
                    }
                },
                error: function () {
                    Swal.close(); // Close loading dialog

                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้ กรุณาลองอีกครั้ง',
                        confirmButtonText: 'ตกลง',
                        customClass: { popup: 'rounded-3' }
                    });
                },
                complete: function () {
                    NProgress.done();
                }
            });
        });

        // Update guest selection
        document.getElementById('adults').addEventListener('change', updateBookingSummary);
        document.getElementById('children').addEventListener('change', updateBookingSummary);

        // Initialize and configure the advertisement carousel
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize the carousel with Bootstrap's carousel method
            const adsCarousel = new bootstrap.Carousel(document.getElementById('adsCarousel'), {
                interval: 5000,  // Change slides every 5 seconds
                wrap: true,      // Cycle continuously
                touch: true,     // Allow touch swipe on mobile
                pause: 'hover'   // Pause on mouse hover
            });
        });
    </script>
    <script>
        function verifyRecaptcha() {
            const recaptchaResponse = grecaptcha.getResponse();
            console.log(recaptchaResponse);
            if (recaptchaResponse.length === 0) {
                return false; // reCAPTCHA not verified
            }
            return true; // reCAPTCHA verified
        }

        function onRecaptchaSuccess(token) {
            $('.btn-book').show();
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/th.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/locale/th.js"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
</body>

</html>
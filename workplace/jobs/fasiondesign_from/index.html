<!DOCTYPE html>
<html lang="en">

<head>
    <!-- no cache -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- no cache -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>maison KEEPS - Design Form</title>
    <meta name="description" content="maison KEEPS - Design Form">
    <meta name="keywords" content="maison KEEPS, Design Form, Fashion Design, Job Application">
    <meta name="author" content="maison KEEPS">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <style>
        * {
            font-family: 'Mitr', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #030403;
            color: #e0e0e0;
        }

        .container {
            max-width: 900px;
        }

        .form-container {
            background-color: #141414;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            padding: 30px;
            margin-top: 20px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        .form-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
        }

        .form-subtitle {
            color: #cccccc;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .steps-container {
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #333333;
            color: #999999;
            font-weight: 500;
            margin: 0 auto 10px auto;
            transition: all 0.3s ease;
        }

        .step-title {
            font-size: 14px;
            color: #999999;
            text-align: center;
            transition: all 0.3s ease;
        }

        .step.active {
            background-color: #2a7fff;
            color: #fff;
        }

        .step-title.active {
            color: #2a7fff;
            font-weight: 500;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .form-label {
            font-weight: 500;
            color: #cccccc;
        }

        .form-control,
        .form-select {
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid #444444;
            /* background-color: #222222; */
            /* color: #e0e0e0; */
            transition: all 0.3s ease;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: #2a7fff;
            box-shadow: 0 0 0 0.25rem rgba(42, 127, 255, 0.25);
            /* background-color: #2a2a2a; */
        }


        .form-check-label {
            color: #cccccc;
        }

        .form-check-input {
            background-color: #222222;
            border-color: #444444;
        }

        .form-check-input:checked {
            background-color: #2a7fff;
            border-color: #2a7fff;
        }

        /* .size-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        } */

        .size-checkboxes+.invalid-feedback {
            display: none;
        }

        .selected-sizes {
            font-size: 0.85rem;
        }

        .selected-sizes span {
            color: #4e95ff;
            font-weight: 500;
        }

        .form-check-inline {
            margin-right: 0;
        }

        .form-check-inline .form-check-input {
            margin-right: 5px;
        }

        .custom-input-group {
            margin-top: 10px;
            display: none;
        }

        .btn-navigation {
            padding: 10px 25px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-next {
            background-color: #2a7fff;
            color: #fff;
            border: none;
        }

        .btn-next:hover {
            background-color: #1a6bec;
            color: #fff;
        }

        .btn-prev {
            background-color: #555555;
            color: #fff;
            border: none;
        }

        .btn-prev:hover {
            background-color: #444444;
            color: #fff;
        }

        .btn-submit {
            background-color: #00a854;
            color: #fff;
            border: none;
        }

        .btn-submit:hover {
            background-color: #008c46;
            color: #fff;
        }

        .required-field::after {
            content: " *";
            color: #ff5252;
        }

        .file-upload-container {
            border: 2px dashed #444444;
            border-radius: 6px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            background-color: #1a1a1a;
        }

        .file-upload-container:hover {
            border-color: #2a7fff;
            background-color: #222222;
        }

        .upload-content {
            flex: 1;
        }

        .file-preview-container {
            margin-top: 15px;
            display: none;
            max-width: 100%;
            text-align: center;
        }

        .file-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
        }

        .file-upload-icon {
            font-size: 40px;
            color: #999999;
            margin-bottom: 10px;
        }

        .file-name {
            font-size: 14px;
            color: #cccccc;
            margin-top: 10px;
            font-weight: 500;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo {
            max-width: 150px;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .border {
            border-color: #333333 !important;
        }

        .bg-secondary-subtle {
            background-color: #222222 !important;
        }

        .text-muted {
            color: #999999 !important;
        }

        .list-group-item {
            background-color: #222222;
            color: #e0e0e0;
            border-color: #333333;
        }

        .btn-danger {
            background-color: #d32f2f;
            border-color: #c62828;
        }

        .btn-danger:hover {
            background-color: #b71c1c;
            border-color: #b71c1c;
        }

        .text-primary {
            color: #4e95ff !important;
        }

        .navbar {
            margin-bottom: 20px;
            padding: 12px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .navbar-brand {
            font-family: 'Mitr', sans-serif;
            font-size: 1.5rem;
            color: #ffffff;
        }

        .navbar-logo {
            height: 40px;
            width: auto;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }

        .navbar-brand:hover .navbar-logo {
            transform: scale(1.05);
        }

        .size-checkboxes {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;

        }

        .form-check-input.is-valid~.form-check-label,
        .was-validated .form-check-input:valid~.form-check-label {
            color: #cccccc
        }

        .form-check-input.is-valid,
        .was-validated .form-check-input:valid {
            background-color: #222222;
            border-color: #444444;
        }

        @media screen and (max-width: 768px) {
            .size-checkboxes {
                grid-template-columns: repeat(2, 1fr);
            }

        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #030403; border-bottom: 1px solid #333;">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center ms-auto me-auto" href="#">
                <!-- <img src="https://img5.pic.in.th/file/secure-sv1/logo_png2dc2b7ca745799f1.png" alt="maison KEEPS Logo" class="navbar-logo me-3 px-2 py-1" style="background-color: #ffffff;"> -->
                <span style="font-weight: 400; letter-spacing: 1.5px;">maison <span
                        style="font-weight: 100;">KEEPS</span></span>
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="form-container" data-aos="fade-up" data-aos-duration="1000">
            <div class="logo-container">
                <img src="https://img2.pic.in.th/pic/logob1b822e17a00f2d7.jpg" alt="maison KEEPS Logo" class="logo">
            </div>
            <h1 class="form-title">Design Form</h1>

            <div class="row steps-container">
                <div class="col-6">
                    <div class="step active" id="step1-indicator">1</div>
                    <div class="step-title active">Product Information</div>
                </div>
                <div class="col-6">
                    <div class="step" id="step2-indicator">2</div>
                    <div class="step-title">Attach Files</div>
                </div>
            </div>

            <form id="designForm">
                <!-- Step 1: Product Information -->
                <div class="form-step active" id="step1">
                    <h3 class="form-subtitle">Product Information</h3>

                    <div class="mb-3">
                        <label for="brandName" class="form-label required-field">Brand Name</label>
                        <select class="form-select" id="brandName" required>
                            <option value="" selected disabled>Select Brand Name</option>
                            <? options.brands.forEach( brand => { ?>
                            <option value="<?= brand ?>">
                                <?= brand ?>
                            </option>
                            <? } ) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="brandNameCustomGroup">
                            <input type="text" class="form-control" id="brandNameCustom" placeholder="Enter Brand Name">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกชื่อแบรนด์
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="mainProductCategory" class="form-label required-field">Main Product Category</label>
                        <select class="form-select" id="mainProductCategory" required>
                            <option value="" selected disabled>Select Main Product Category</option>
                            <? Object.keys(options.mainProducts).forEach(function (category) { ?>
                            <option value="<?= category ?>">
                                <?= category ?>
                            </option>
                            <? }) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="mainProductCategoryCustomGroup">
                            <input type="text" class="form-control" id="mainProductCategoryCustom"
                                placeholder="Enter Main Product Category">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกหมวดหมู่หลักของสินค้า
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="subProductCategory" class="form-label required-field">Sub Product Category</label>
                        <select class="form-select" id="subProductCategory">
                            <option value="" selected disabled>Select Sub Product Category</option>
                            <? Object.keys(options.mainProducts).forEach(function (category) { ?>
                            <? options.mainProducts[category].sort((a,b) => a - b).forEach(function (subCategory) { ?>
                            <option value="<?= subCategory ?>" data-main-product="<?= category ?>"
                                style="display: none;">
                                <?= subCategory ?>
                            </option>
                            <? }) ?>
                            <? }) ?>
                        </select>
                        <div class="custom-input-group" id="subProductCategoryCustomGroup">
                            <input type="text" class="form-control" id="subProductCategoryCustom"
                                placeholder="Enter Sub Product Category">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกหมวดหมู่ย่อยของสินค้า
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label required-field">Type</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="productType" id="typeNew" value="New"
                                checked required>
                            <label class="form-check-label" for="typeNew">
                                New
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="productType" id="typeExtension"
                                value="Extension" required>
                            <label class="form-check-label" for="typeExtension">
                                Extension
                            </label>
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกประเภทของสินค้า
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="productName" class="form-label required-field">Product Name</label>
                        <select class="form-select" id="productName" required>
                            <option value="" selected disabled>Select Product Name</option>
                            <? options.productsName.forEach(function (product) { ?>
                            <option value="<?= product ?>">
                                <?= product ?>
                            </option>
                            <? }) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="productNameCustomGroup">
                            <input type="text" class="form-control" id="productNameCustom"
                                placeholder="Enter Product Name">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกชื่อสินค้า
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="colorOne" class="form-label required-field">Color #1</label>
                        <select class="form-select" id="colorOne" required>
                            <option value="" selected disabled>Select Color</option>
                            <? options.colors1.forEach(function (color) { ?>
                            <option value="<?= color ?>">
                                <?= color ?>
                            </option>
                            <? }) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="colorOneCustomGroup">
                            <input type="text" class="form-control" id="colorOneCustom" placeholder="Enter Color">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกสีที่ 1
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="colorTwo" class="form-label">Color #2 (Optional)</label>
                        <select class="form-select" id="colorTwo">
                            <option value="" selected>Select Color (Optional)</option>
                            <? options.colors2.forEach(function (color) { ?>
                            <option value="<?= color ?>">
                                <?= color ?>
                            </option>
                            <? }) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="colorTwoCustomGroup">
                            <input type="text" class="form-control" id="colorTwoCustom" placeholder="Enter Color">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกสีที่ 2
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="technique" class="form-label required-field">Technique</label>
                        <select class="form-select" id="technique" required>
                            <option value="" selected disabled>Select Technique</option>
                            <? options.techniques.forEach(function (technique) { ?>
                            <option value="<?= technique ?>">
                                <?= technique ?>
                            </option>
                            <? }) ?>
                            <option value="other">Other</option>
                        </select>
                        <div class="custom-input-group" id="techniqueCustomGroup">
                            <input type="text" class="form-control" id="techniqueCustom" placeholder="Enter Technique">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกหรือกรอกเทคนิคการผลิต
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label required-field">Size</label>
                        <div class="size-checkboxes">
                            <? options.sizes.forEach(function (size) { ?>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" name="size" id="size<?= size ?>"
                                    value="<?= size ?>">
                                <label class="form-check-label" for="size<?= size ?>">
                                    <?= size ?>
                                </label>
                            </div>
                            <? }) ?>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="checkbox" id="otherSizeCheck" value="other">
                            <label class="form-check-label" for="otherSizeCheck">
                                Other
                            </label>
                        </div>
                        <div class="custom-input-group" id="sizeCustomGroup">
                            <input type="text" class="form-control" id="sizeCustom" placeholder="Enter Size">
                        </div>
                        <div class="invalid-feedback">
                            กรุณาเลือกขนาดอย่างน้อยหนึ่งขนาด
                        </div>
                        <div class="selected-sizes mt-2">
                            <small class="text-muted">Selected sizes: <span id="selectedSizesText">None</span></small>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="productFor" class="form-label required-field">For</label>
                        <select class="form-select" id="productFor" required>
                            <option value="" selected disabled>Select For</option>
                            <? options.productFor.forEach(function (group) { ?>
                            <option value="<?= group ?>">
                                <?= group ?>
                            </option>
                            <? }) ?>
                        </select>
                        <div class="invalid-feedback">
                            กรุณาเลือกกลุ่มเป้าหมาย
                        </div>
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <button type="button" class="btn btn-navigation btn-next" id="nextStep">Next <i
                                class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Attach Files -->
                <div class="form-step" id="step2">
                    <h3 class="form-subtitle">Attach Files</h3>
                    <div class="border rounded p-3 mb-4">
                        <label class="form-label required-field">Product Packshot</label>
                        <div class="rounded-3 border bg-secondary-subtle p-1 text-center" style="cursor: pointer;"
                            id="image-label">
                            <i class="bi bi-cloud-arrow-up-fill text-primary me-2"></i>
                            <span class="uploadLabel">Click to select Files</spam>
                        </div>
                        <input type="file" class="d-none" id="packshotFile" multiple>
                        <input type="file" id="packshotFileHandle" multiple required hidden>

                        <div id="packshotFileList" class="mt-3">
                            <p class="text-muted">No file selected</p>
                        </div>
                        <div class="invalid-feedback">
                            กรุณาอัปโหลดภาพผลิตภัณฑ์อย่างน้อยหนึ่งรูป
                        </div>
                    </div>
                    <div class="border rounded p-3 mb-4">
                        <label class="form-label required-field">ใบคอนเฟิร์มผลิต</label>
                        <div class="rounded-3 border bg-secondary-subtle p-1 text-center" style="cursor: pointer;"
                            id="confirmation-label">
                            <i class="bi bi-cloud-arrow-up-fill text-primary me-3"></i>
                            <span class="uploadLabel">Click to select Files</span>
                        </div>
                        <input type="file" class="d-none" id="confirmationFile" multiple>
                        <input type="file" id="confirmationFileHandle" multiple required hidden>
                        <div id="confirmationFileList" class="mt-3">
                            <p class="text-muted">No file selected</p>
                        </div>
                        <div class="invalid-feedback">
                            กรุณาอัปโหลดไฟล์ใบคอนเฟิร์มผลิตอย่างน้อยหนึ่งไฟล์
                        </div>
                    </div>
                    <div class="border rounded p-3 mb-4">
                        <label class="form-label">Logo (Optional)</label>
                        <div class="rounded-3 border bg-secondary-subtle p-1 text-center" style="cursor: pointer;"
                            id="logo-label">
                            <i class="bi bi-cloud-arrow-up-fill text-primary me-3"></i>
                            <span class="uploadLabel">Click to select Files</span>
                        </div>
                        <input type="file" class="d-none" id="logoFile" multiple>
                        <input type="file" id="logoFileHandle" multiple hidden>
                        <div id="logoFileList" class="mt-3">
                            <p class="text-muted">No file selected</p>
                        </div>
                        <div class="invalid-feedback">
                            กรุณาอัปโหลดโลโก้หากมี
                        </div>
                    </div>
                    <div class="border rounded p-3 mb-4">
                        <label class="form-label required-field">Size Chart</label>
                        <div class="rounded-3 border bg-secondary-subtle p-1 text-center" style="cursor: pointer;"
                            id="sizeChart-label">
                            <i class="bi bi-cloud-arrow-up-fill text-primary me-3"></i>
                            <span class="uploadLabel">Click to select Files</span>
                        </div>
                        <input type="file" class="d-none" id="sizeChartFile" multiple>
                        <input type="file" id="sizeChartFileHandle" multiple required hidden>
                        <div id="sizeChartFileList" class="mt-3">
                            <p class="text-muted">No file selected</p>
                        </div>
                        <div class="invalid-feedback">
                            กรุณาอัปโหลดไฟล์ตารางขนาดอย่างน้อยหนึ่งไฟล์
                        </div>
                    </div>
                    <div class="border rounded p-3 mb-4">
                        <label for="recorderName" class="form-label required-field">ชื่อผู้บันทึก</label>
                        <input type="text" class="form-control" id="recorderName" placeholder="กรุณากรอกชื่อผู้บันทึก"
                            required>
                        <div class="invalid-feedback">
                            กรุณากรอกชื่อผู้บันทึก
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-navigation btn-prev" id="prevStep"><i
                                class="bi bi-arrow-left"></i> Previous</button>
                        <button type="button" class="btn btn-navigation btn-submit" id="submitForm">Submit <i
                                class="bi bi-check-circle"></i></button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <input type="file" id="handleFiles" value="" hidden>
    <script>
        window.addEventListener('DomainLoaded', function () {
            // Initialize NProgress
            NProgress.start();
            NProgress.inc();
        });
        $(document).ready(function () {
            NProgress.done();
            // Initialize AOS
            AOS.init();

            addEventToOtherOptionSelects();
            addEventToFileSelection();

            // Initialize selected sizes text
            updateSelectedSizesText();

            // Step navigation
            let currentStep = 1;

            const showStep = function (step) {
                $('.form-step').removeClass('active');
                $(`#step${step}`).addClass('active');

                $('.step').removeClass('active');
                $(`#step${step}-indicator`).addClass('active');
                $('.step-title').removeClass('active');
                $(`#step${step}-indicator`).next('.step-title').addClass('active');
            }
            $('#nextStep').click(function () {
                if (currentStep < 2) {
                    // Check if at least one size checkbox is selected or custom size is filled
                    let sizeValid = false;
                    $('input[name="size"]:checked').each(function () {
                        sizeValid = true;
                    });

                    if ($('#otherSizeCheck').is(':checked') && $('#sizeCustom').val()) {
                        sizeValid = true;
                    }

                    if (!sizeValid) {
                        $('.size-checkboxes').siblings('.invalid-feedback').show();
                    } else {
                        $('.size-checkboxes').siblings('.invalid-feedback').hide();
                    }

                    // Check if all required fields in step 1 are filled
                    let valid = true;
                    $('#step1 .form-control, #step1 .form-select').each(function () {
                        if ($(this).prop('required') && !$(this).val()) {
                            valid = false;
                        }
                    });
                    if (!$('input[name="size"]').is(':checked') && !$('#otherSizeCheck').is(':checked')) {
                        valid = false;
                    }
                    if (!valid) {
                        $('#designForm').addClass('was-validated');
                    } else {
                        $('#designForm').removeClass('was-validated');
                        currentStep++;
                        showStep(currentStep);
                    }
                }
            });
            $('#prevStep').click(function () {
                if (currentStep > 1) {
                    currentStep--;
                    showStep(currentStep);
                }
            });

            $('#submitForm').on('click', handleFormSubmission);
        });

        function addEventToOtherOptionSelects() {
            const otherOptions = [
                { selectId: '#brandName', customInputId: '#brandNameCustom', groupId: '#brandNameCustomGroup' },
                { selectId: '#mainProductCategory', customInputId: '#mainProductCategoryCustom', groupId: '#mainProductCategoryCustomGroup' },
                { selectId: '#subProductCategory', customInputId: '#subProductCategoryCustom', groupId: '#subProductCategoryCustomGroup' },
                { selectId: '#productName', customInputId: '#productNameCustom', groupId: '#productNameCustomGroup' },
                { selectId: '#colorOne', customInputId: '#colorOneCustom', groupId: '#colorOneCustomGroup' },
                { selectId: '#colorTwo', customInputId: '#colorTwoCustom', groupId: '#colorTwoCustomGroup' },
                { selectId: '#technique', customInputId: '#techniqueCustom', groupId: '#techniqueCustomGroup' }
            ];

            otherOptions.forEach(option => {
                $(option.selectId).change(function () {
                    if ($(this).val() === 'other') {
                        $(this).removeAttr('required');
                        $(option.customInputId).val('').show().attr('required', true);
                        $(option.groupId).show();
                    } else {
                        $(this).attr('required', true);
                        $(option.customInputId).val('').hide().removeAttr('required');
                        $(option.groupId).hide();
                    }
                });
            });

            $('#mainProductCategory').change(function () {
                const selectedCategory = $(this).val();
                $('#subProductCategory option').each(function () {
                    if ($(this).data('main-product') === selectedCategory) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
                $('#subProductCategory').val('').trigger('change');
            });

            // Handle the size "other" checkbox
            $('#otherSizeCheck').change(function () {
                if ($(this).is(':checked')) {
                    $('#sizeCustom').val('').show().attr('required', true);
                    $('#sizeCustomGroup').show();
                } else {
                    $('#sizeCustom').val('').hide().removeAttr('required');
                    $('#sizeCustomGroup').hide();
                }
                updateSelectedSizesText();
            });

            // Handle the size checkboxes
            $('input[name="size"]').change(function () {
                updateSelectedSizesText();
            });

            // Handle the custom size input
            $('#sizeCustom').on('input', function () {

                updateSelectedSizesText();
            });
            // Initialize the Other size input as hidden
            $('#sizeCustomGroup').hide();
        }

        // File upload functionality
        function addEventToFileSelection(fileInputId, labelId, fileListId) {
            const fileSelections = [
                { inputId: '#packshotFile', labelId: '#image-label', listId: '#packshotFileList', handleId: '#packshotFileHandle' },
                { inputId: '#confirmationFile', labelId: '#confirmation-label', listId: '#confirmationFileList', handleId: '#confirmationFileHandle' },
                { inputId: '#logoFile', labelId: '#logo-label', listId: '#logoFileList', handleId: '#logoFileHandle' },
                { inputId: '#sizeChartFile', labelId: '#sizeChart-label', listId: '#sizeChartFileList', handleId: '#sizeChartFileHandle' }
            ];

            fileSelections.forEach(file => {
                $(file.labelId).click(function () {
                    $(file.inputId).click();
                });

                $(file.inputId).change(function () {
                    const files = this.files;
                    if (files.length > 0) {
                        let handle_files = $(file.handleId)[0].files || [];
                        let dt = new DataTransfer();
                        // Create a new DataTransfer object to handle the files
                        for (let i = 0; i < handle_files.length; i++) {
                            dt.items.add(handle_files[i]);
                        }
                        // Add the newly selected files to the DataTransfer object
                        let handle_file_names = Array.from(handle_files).map(f => f.name);
                        for (let i = 0; i < files.length; i++) {
                            let isDuplicate = handle_file_names.includes(files[i].name);

                            if (!isDuplicate) {
                                dt.items.add(files[i]);
                            }
                        }
                        // Update the file input with the new FileList
                        $(file.inputId).val(''); // Clear the input value to allow re-selection of
                        $(file.handleId)[0].files = dt.files;
                        $(file.labelId).find('.uploadLabel').text(`${$(file.handleId)[0].files.length} file(s) selected`);

                        handle_files = $(file.handleId)[0].files;
                        let ul = $('<ul class="list-group"></ul>');
                        for (let i = 0; i < handle_files.length; i++) {
                            const fileName = handle_files[i].name;
                            ul.append(`<li class="list-group-item d-flex justify-content-between align-items-center form-text">
                                ${fileName}
                                <button class="btn btn-danger btn-sm delete-file" data-file-name="${fileName}" data-input="${file.handleId}" data-index="${i}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </li>`);
                        }
                        $(file.listId).html(ul);

                        // Add event listeners to delete buttons
                        $(file.listId).find('.delete-file').click(function (e) {
                            e.preventDefault();
                            const fileName = $(this).data('file-name');
                            const handleInput = $(this).data('input');
                            const handle_files = $(handleInput)[0].files;
                            let dt = new DataTransfer();
                            for (let j = 0; j < handle_files.length; j++) {
                                if (handle_files[j].name !== fileName) {
                                    dt.items.add(handle_files[j]);
                                }
                            }
                            $(handleInput)[0].files = dt.files;
                            console.log('Updated files:', $(handleInput)[0].files);
                            $(this).closest('li').remove();
                            $(file.labelId).find('.uploadLabel').text(`${$(handleInput)[0].files.length} file(s) selected`);
                            if ($(handleInput)[0].files.length === 0) {
                                $(file.listId).html('<p class="text-muted">No file selected</p>');
                                $(file.labelId).find('.uploadLabel').text('Click to select Files');
                            }

                        });
                    } else {
                        $(file.listId).html('<p class="text-muted">No file selected</p>');
                    }
                });
            });
        }

        function updateSelectedSizesText() {
            $('.size-checkboxes').siblings('.invalid-feedback').hide();
            let selectedSizes = [];

            // Get checked sizes
            $('input[name="size"]:checked').each(function () {
                selectedSizes.push($(this).val());
            });

            // Add custom size if applicable
            if ($('#otherSizeCheck').is(':checked') && $('#sizeCustom').val().trim()) {
                selectedSizes.push($('#sizeCustom').val().trim().toUpperCase());
            }

            // Update the text
            if (selectedSizes.length > 0) {
                $('#selectedSizesText').text(selectedSizes.join(', '));
            } else {
                $('#selectedSizesText').text('None');
            }
        }


        function handleFormSubmission(event) {
            event.preventDefault();
            // Validate the form
            if (!$('#designForm')[0].checkValidity()) {
                $('#designForm').addClass('was-validated');
                if (!$('input[name="size"]:checked').length && !$('#otherSizeCheck').is(':checked')) {
                    $('.size-checkboxes').siblings('.invalid-feedback').show();
                } else {
                    $('.size-checkboxes').siblings('.invalid-feedback').hide();
                }
                console.log($('#designForm')[0].checkValidity());
                return;
            } else {
                $('#designForm').removeClass('was-validated');
            }

            let handle_all_files = [
                { inputId: '#packshotFileHandle', labelId: '#packshotFileList' },
                { inputId: '#confirmationFileHandle', labelId: '#confirmationFileList' },
                { inputId: '#logoFileHandle', labelId: '#logoFileList' },
                { inputId: '#sizeChartFileHandle', labelId: '#sizeChartFileList' }
            ];
            let handleFiles = $('#handleFiles')[0].files || [];
            let dt = new DataTransfer();
            handle_all_files.forEach(file => {
                let handle_files = $(file.inputId)[0].files || [];
                for (let i = 0; i < handle_files.length; i++) {
                    let new_name = file.inputId.replace('#', '').replace('FileHandle', '') + ' - ' + handle_files[i].name;
                    dt.items.add(new File([handle_files[i]], new_name, {
                        type: handle_files[i].type
                    }));
                }
            });
            $('#handleFiles')[0].files = dt.files;
            handleFiles = $('#handleFiles')[0].files;
            if (handleFiles.length === 0) {
                Swal.fire({
                    icon: 'error',
                    title: 'ไม่มีไฟล์ที่เลือก',
                    text: 'กรุณาอเลือกไฟล์ที่บังคับเพื่อดำเนินการต่อ',
                    confirmButtonText: 'ตกลง',
                    customClass: {
                        popup: 'rounded-4'
                    }
                });
                return;
            }
            uploadFiles().then((res) => {
                let { files, uid } = res;
                console.log('Uploaded files:', files);
                console.log('UID:', uid);
                const getValue = (selector) => {
                    return $(selector).val() === 'other' ? $(selector + 'Custom').val() : $(selector).val();
                };
                const formData = {
                    brandName: getValue('#brandName'),
                    mainProductCategory: getValue('#mainProductCategory'),
                    subProductCategory: getValue('#subProductCategory'),
                    productType: $('input[name="productType"]:checked').val(),
                    productName: getValue('#productName'),
                    colorOne: getValue('#colorOne'),
                    colorTwo: getValue('#colorTwo'),
                    technique: getValue('#technique'),
                    sizes: $('input[name="size"]:checked').map(function () {
                        return $(this).val().trim().toUpperCase();
                    }).toArray().join(', ') + ($('#otherSizeCheck').is(':checked') && $('#sizeCustom').val().trim() ? ', ' + $('#sizeCustom').val().trim().toUpperCase() : ''),
                    productFor: $('#productFor').val(),
                    packshotFiles: files['packshot'] ? files['packshot'].join(', ') : "",
                    confirmationFiles: files['confirmation'] ? files['confirmation'].join(', ') : "",
                    logoFiles: files['logo'] ? files['logo'].join(', ') : "",
                    sizeChartFiles: files['sizeChart'] ? files['sizeChart'].join(', ') : "",
                    recorderName: $('#recorderName').val(),
                    uid: uid,
                    folder: 'https://drive.google.com/drive/folders/' + res.folder_id
                };
                console.log('Form Data:', formData);
            }).catch((err) => {
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: err,
                    confirmButtonText: 'ตกลง',
                    customClass: {
                        popup: 'rounded-4'
                    }
                });
            });

        }

        async function uploadFiles() {
            const f = document.getElementById("handleFiles");
            if (f.files.length == 0) {
                return []
            }
            NProgress.start();
            NProgress.inc();
            Swal.fire({
                iconHtml: '<i class="bi bi-cloud-arrow-up-fill text-primary" style="font-size: 3rem;"></i>',
                title: 'กำลังอัพโหลดไฟล์',
                background: '#141414',
                color: '#e0e0e0',
                customClass: {
                    icon: 'border-0',
                    title: 'text-white',
                    content: 'text-light',
                    popup: 'rounded-4 border border-dark',
                    confirmButton: 'btn-primary'
                },
                allowOutsideClick: false,
                html: '<div class="container-fluid"><div class="row" id="progress"></div></div>',
                didOpen: () => {
                    Swal.showLoading()
                },
            })
            const { token, folder_id, uid } = await getDownloadToken();
            let file = await new Promise((resolve, reject) => {
                let length = f.files.length;
                let count = 0;
                let uploadfiles = [];
                [...f.files].forEach((file, i) => {
                    let fr = new FileReader();
                    fr.fileName = file.name;
                    fr.fileSize = file.size;
                    fr.fileType = file.type;
                    fr.readAsArrayBuffer(file);
                    fr.onload = e => {
                        var id = "p" + ++i;
                        var div = $("<div>", { class: 'col-12 text-truncate mb-2' });
                        div.attr("id", id);
                        $("#progress").append(div);
                        $('#' + id).text('Initialising (' + fr.fileName + ')')
                        const f = e.target;
                        const resource = {
                            fileName: f.fileName,
                            fileSize: f.fileSize,
                            fileType: f.fileType,
                            fileBuffer: f.result,
                            accessToken: token,
                            folderId: folder_id,
                            fields: "id, name"
                        };
                        const ru = new ResumableUploadToGoogleDrive();
                        ru.Do(resource, function (res, err) {
                            if (err) {
                                console.log(err);
                                return;
                            }
                            console.log(res);
                            let msg = "";
                            if (res.status == 'start' || res.status == 'getLocation' || res.status == 'initialize') {
                                msg = '<i class="bi bi-cloud-arrow-up-fill text-primary me-2"></i> กำลังเตรียมอัพโหลด ' + f.fileName;
                            }
                            else if (res.status == "Uploading") {
                                msg =
                                    '<i class="bi bi-hourglass-split text-primary me-2"></i> กำลังอัพโหลด ' +
                                    Math.round(
                                        (res.progressNumber.current / res.progressNumber.end) * 100
                                    ) +
                                    "% (" +
                                    f.fileName +
                                    ")";
                            } else {
                                msg = '<i class="bi bi-check-circle-fill text-success me-2"></i> อัพโหลดสำเร็จ  (' + f.fileName + ")";
                            }

                            // If you want to put the uploaded file information to the active Spreadsheet,
                            // please use the following function.
                            if (res.status == "Done") {
                                uploadfiles.push({
                                    id: res.result.id,
                                    name: res.result.name
                                });
                                if (uploadfiles.length == length) {
                                    resolve(uploadfiles);
                                }
                            }

                            $('#' + id).html(msg)
                        });
                    };
                });
            });
            NProgress.done();
            console.log('Uploaded files:', file);
            return {
                files: file.reduce((acc, curr) => {
                    let name = curr.name.split(' - ')[0];
                    if (!acc[name]) {
                        acc[name] = [];
                    }
                    acc[name].push('https://drive.google.com/uc?id=' + curr.id);
                    return acc;
                }, {}),
                uid: uid,
                folder_id: folder_id
            }
        }

        function getDownloadToken() {
            return new Promise((resolve, reject) => {
                google.script.run.withSuccessHandler((res) => {
                    res = JSON.parse(res);
                    if (res.success) {
                        resolve(res.data);
                    } else {
                        reject(res.message);
                    }
                }).getDownloadToken();
            });
        }


    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/locale/th.js"></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script
        src="https://cdn.jsdelivr.net/gh/tanaikech/ResumableUploadForGoogleDrive_js@master/resumableupload_js.min.js">
        </script>
</body>

</html>
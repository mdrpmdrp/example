<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- no cache -->
    <meta http-equiv="Cache-Conatrol" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THAILAND LOCKSMITH 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7/dist/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <!-- /icon -->
    <link rel="icon" href="https://img2.pic.in.th/pic/1730737040513.png" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #e9e4bf 0%, #d4cfaf 100%);
            min-height: 100vh;
            padding: 20px 0;
        }

        .container {
            max-width: 440px;
        }

        /* Modern Card Design */
        .card-modern {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .card-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        }

        /* Header Styles */
        .header-modern {
            background: linear-gradient(135deg, #004225 0%, #006837 100%);
            border-radius: 24px;
            padding: 32px 24px;
            box-shadow: 0 8px 32px rgba(0, 66, 37, 0.3);
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .header-modern::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(180deg); }
        }

        .header-modern img {
            position: relative;
            z-index: 1;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .header-text {
            color: #ffffff;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }

        /* Modern Button Styles */
        .btn-card {
            position: relative;
            overflow: hidden;
            border: none;
            border-radius: 20px;
            padding: 20px 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            cursor: pointer;
        }

        .btn-card::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-card:hover::before {
            width: 400px;
            height: 400px;
        }

        .btn-orange {
            background: linear-gradient(135deg, #f2a137 0%, #e89125 100%);
            color: #000;
        }

        .btn-orange:hover {
            background: linear-gradient(135deg, #e89125 0%, #c05d10 100%);
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(192, 93, 16, 0.4);
        }

        .btn-gold {
            background: linear-gradient(135deg, #fcc715 0%, #f7a614 100%);
            color: #000;
        }

        .btn-gold:hover {
            background: linear-gradient(135deg, #f7a614 0%, #e89d0d 100%);
            color: #fff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(247, 166, 20, 0.4);
        }

        .btn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            margin-left: 12px;
            transition: all 0.3s ease;
        }

        .btn-card:hover .btn-icon {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.5);
        }

        /* Form Styles */
        .form-control {
            background-color: #f5f5f5;
            color: #333;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .form-control:focus {
            background-color: #fff;
            border-color: #f2a137;
            box-shadow: 0 0 0 4px rgba(242, 161, 55, 0.1);
            outline: none;
        }

        .form-control::placeholder {
            color: #999;
        }

        form label {
            font-size: 0.95rem !important;
            color: #4b4b49;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #004225;
            margin: 24px 0 16px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #f2a137;
            display: inline-block;
        }

        /* Radio and Checkbox Styles */
        .form-check {
            padding: 12px 16px;
            margin: 8px 0;
            background: #f8f8f8;
            border-radius: 12px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .form-check:hover {
            background: #fff;
            border-color: #f2a137;
            transform: translateX(4px);
        }

        .form-check-input {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            border: 2px solid #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-check-input:checked {
            background-color: #f2a137;
            border-color: #f2a137;
        }

        .form-check-input:focus {
            box-shadow: 0 0 0 4px rgba(242, 161, 55, 0.2);
        }

        .form-check-label {
            cursor: pointer;
            user-select: none;
        }

        /* Submit Button */
        .submit-btn {
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #64e27e 0%, #36b258 100%);
            padding: 16px 48px;
            border: none;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(54, 178, 88, 0.4);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.1rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(54, 178, 88, 0.5);
        }

        .submit-btn:active {
            transform: translateY(0px);
        }

        /* Spacing and Layout */
        .row.g-4 {
            margin-bottom: 16px;
        }

        /* Validation Styles */
        .invalid-feedback {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 4px;
        }

        .form-control.is-invalid {
            border-color: #dc3545;
        }

        /* Helper Text */
        .form-text {
            color: #6c757d;
            font-size: 0.875rem;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 576px) {
            .container {
                padding: 0 16px;
            }

            .card-modern {
                padding: 20px;
                border-radius: 20px;
            }

            .header-modern {
                padding: 24px 20px;
                border-radius: 20px;
            }
        }

        /* Loading Overlay Custom */
        .loadingoverlay {
            background: rgba(0, 66, 37, 0.9) !important;
        }

        /* Select Dropdown */
        select.form-control {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23333' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px 12px;
            padding-right: 40px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header-modern container-fluid d-flex flex-column justify-content-center align-items-center">
            <img src="https://img2.pic.in.th/pic/1730737040513.png" alt="Thailand Locksmith Logo" style="width: 100px; max-height: 100px;"
                class="img-fluid mb-3">
            <div class="h3 lh-base fw-bold w-100 header-text text-center">ลงทะเบียนเข้าร่วมงาน<br>THAILAND LOCKSMITH 2025
            </div>
        </header>
        <main class="container-fluid">
            <section id="page1" class="pages d-none">
                <div class="row g-4">
                    <div class="col-12">
                        <button class="btn btn-card btn-orange w-100 fw-bold d-flex align-items-center justify-content-between"
                            onclick="window.location.href='?p=2'">
                            <span class="flex-grow-1 text-start ps-2">
                                <div class="fs-5">ลงทะเบียน เข้าร่วมงาน</div>
                                <div class="fs-6" style="opacity: 0.9;">กรณีมีรหัสลูกค้าผลเลิศ</div>
                            </span>
                            <span class="btn-icon">
                                <i class="bi bi-chevron-right fs-5"></i>
                            </span>
                        </button>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-card btn-gold w-100 fw-bold d-flex align-items-center justify-content-between"
                            onclick="window.location.href='?p=3'">
                            <span class="flex-grow-1 text-start ps-2">
                                <div class="fs-5">ลงทะเบียน เข้าร่วมงาน</div>
                                <div class="fs-6" style="opacity: 0.9;">กรณียังไม่มีรหัสลูกค้า</div>
                            </span>
                            <span class="btn-icon">
                                <i class="bi bi-chevron-right fs-5"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </section>
            <section id="page2" class="pages d-none">
                <div class="card-modern">
                    <form id="id-checker" class="needs-validation" novalidate>
                        <div class="text-center mb-4">
                            <i class="bi bi-person-badge fs-1" style="color: #f2a137;"></i>
                            <h4 class="mt-2" style="color: #004225;">ตรวจสอบรหัสลูกค้า</h4>
                        </div>
                        <div class="row g-4">
                            <div class="col-12">
                                <div class="row g-3 align-items-center">
                                    <div class="col-12">
                                        <label for="check-id" class="form-label">รหัสลูกค้าผลเลิศ</label>
                                        <input type="text" class="form-control text-center form-control-lg" id="check-id" name="check-id" placeholder="กรอกรหัสลูกค้าของคุณ"
                                            required>
                                        <div class="invalid-feedback text-center">
                                            กรุณากรอกรหัสลูกค้า
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 text-center">
                                <button type="submit" class="submit-btn fs-5">
                                    ตรวจสอบ
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-modern d-none" id="member-form-card">
                    <form id="member-form" class="needs-validation" novalidate>
                        <div class="text-center mb-4">
                            <i class="bi bi-person-check-fill fs-1" style="color: #36b258;"></i>
                            <h4 class="mt-2" style="color: #004225;">กรอกข้อมูลลงทะเบียน</h4>
                        </div>
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="member-id" class="form-label"><i class="bi bi-card-text me-2"></i>รหัสลูกค้า</label>
                                <input type="text" class="form-control" id="member-id" name="member-id" readonly>
                            </div>
                            <div class="col-12">
                                <label for="name" class="form-label"><i class="bi bi-person-fill me-2"></i>ชื่อ-นามสกุล</label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="ระบุชื่อ-นามสกุล" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกชื่อ-นามสกุล
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="province" class="form-label"><i class="bi bi-geo-alt-fill me-2"></i>จังหวัด</label>
                                <input type="text" class="form-control" id="province" name="province" placeholder="ระบุจังหวัด" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกจังหวัด
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="phone" class="form-label"><i class="bi bi-telephone-fill me-2"></i>เบอร์โทรศัพท์</label>
                                <input type="tel" class="form-control" id="phone" name="phone" placeholder="0812345678" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกเบอร์โทรศัพท์
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section-title w-100 mt-4">
                            <i class="bi bi-calendar-event me-2"></i>วันที่สนใจเข้าร่วมงาน
                        </div>
                        <div class="mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="date1"
                                    value="วันเสาร์ที่ 14 ธันวาคม 2567" required>
                                <label class="form-check-label" for="date1">
                                    <strong>วันเสาร์ที่ 14 ธันวาคม 2567</strong>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="date2"
                                    value="วันอาทิตย์ที่ 15 ธันวาคม 2567" required>
                                <label class="form-check-label" for="date2">
                                    <strong>วันอาทิตย์ที่ 15 ธันวาคม 2567</strong>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="date3"
                                    value="เข้าร่วมทั้ง 2 วัน" required>
                                <label class="form-check-label" for="date3">
                                    <strong>เข้าร่วมทั้ง 2 วัน</strong> <span class="badge bg-warning text-dark ms-2">แนะนำ</span>
                                </label>
                                <div class="invalid-feedback">
                                    กรุณาเลือกวันที่สนใจเข้าร่วมงาน
                                </div>
                            </div>
                            <small class="form-text d-block mt-2 text-center">(2 วันที่จะยกระดับความเชี่ยวชาญในอาชีพของคุณ)</small>
                        </div>

                        <div class="mt-4">
                            <label for="follower" class="form-label">
                                <i class="bi bi-person-plus-fill me-2"></i>ผู้ติดตาม (ถ้ามี)
                            </label>
                            <input type="text" class="form-control" id="follower" name="follower" placeholder="ระบุชื่อ-นามสกุลผู้ติดตาม (ถ้ามี)">
                            <small class="form-text d-block mt-1">(ตรวจสอบโดยอ้างอิงจากบัตรประชาชน)</small>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="submit-btn fs-5">
                                <i class="bi bi-check-circle me-2"></i>สมัครลงทะเบียน
                            </button>
                        </div>
                    </form>
                </div>
            </section>
            <section id="page3" class="pages d-none">
                <div class="card-modern">
                    <form id="guest-form" class="needs-validation" novalidate>
                        <div class="text-center mb-4">
                            <i class="bi bi-person-plus-fill fs-1" style="color: #fcc715;"></i>
                            <h4 class="mt-2" style="color: #004225;">ลงทะเบียนผู้เข้าร่วมงานทั่วไป</h4>
                        </div>
                        
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="guest-name" class="form-label"><i class="bi bi-person-fill me-2"></i>ชื่อ-นามสกุล</label>
                                <input type="text" class="form-control" id="guest-name" name="guest-name" placeholder="ระบุชื่อ-นามสกุล" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกชื่อ-นามสกุล
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="guest-province" class="form-label"><i class="bi bi-geo-alt-fill me-2"></i>จังหวัด</label>
                                <input type="text" class="form-control" id="guest-province" name="guest-province" placeholder="ระบุจังหวัด" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกจังหวัด
                                </div>
                            </div>
                            <div class="col-12">
                                <label for="guest-phone" class="form-label"><i class="bi bi-telephone-fill me-2"></i>เบอร์โทรศัพท์</label>
                                <input type="tel" class="form-control" id="guest-phone" name="guest-phone" placeholder="0812345678" required>
                                <div class="invalid-feedback">
                                    กรุณากรอกเบอร์โทรศัพท์
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label"><i class="bi bi-tools me-2"></i>อาชีพ</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="guest-occupation" id="oc1"
                                        value="ช่างกุญแจ" required>
                                    <label class="form-check-label" for="oc1">ช่างกุญแจ</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="guest-occupation" id="oc2"
                                        value="ช่างมอเตอร์ไซค์" required>
                                    <label class="form-check-label" for="oc2">ช่างมอเตอร์ไซค์</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="guest-occupation" id="oc3"
                                        value="ช่างซ่อมรถยนต์" required>
                                    <label class="form-check-label" for="oc3">ช่างซ่อมรถยนต์</label>
                                </div>
                                <div class="invalid-feedback">
                                    กรุณาเลือกอาชีพอย่างน้อย 1 อย่าง
                                </div>
                            </div>

                            <div class="col-12">
                                <label for="guest-interest" class="form-label"><i class="bi bi-bag-fill me-2"></i>สินค้าที่สนใจ</label>
                                <select class="form-control" id="guest-interest" name="guest-interest" required>
                                    <option value="">-- เลือกสินค้าที่สนใจ --</option>
                                    <option value="เครื่องตัดกุญแจอัตโนมัติ">เครื่องตัดกุญแจอัตโนมัติ</option>
                                    <option value="เครื่องตัดกุญแจมาตรฐาน">เครื่องตัดกุญแจมาตรฐาน</option>
                                    <option value="อุปกรณ์ช่างกุญแจ">อุปกรณ์ช่างกุญแจ</option>
                                    <option value="เครื่องโปรแกรมชิพและรีโมท">เครื่องโปรแกรมชิพและรีโมท</option>
                                </select>
                                <div class="invalid-feedback">
                                    กรุณาเลือกสินค้าที่สนใจ
                                </div>
                            </div>
                        </div>

                        <div class="form-section-title w-100 mt-4">
                            <i class="bi bi-calendar-event me-2"></i>วันที่สนใจเข้าร่วมงาน
                        </div>
                        <div class="mt-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="gdate1"
                                    value="วันเสาร์ที่ 14 ธันวาคม 2567" required>
                                <label class="form-check-label" for="gdate1">
                                    <strong>วันเสาร์ที่ 14 ธันวาคม 2567</strong>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="gdate2"
                                    value="วันอาทิตย์ที่ 15 ธันวาคม 2567" required>
                                <label class="form-check-label" for="gdate2">
                                    <strong>วันอาทิตย์ที่ 15 ธันวาคม 2567</strong>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="date" id="gdate3"
                                    value="เข้าร่วมทั้ง 2 วัน" required>
                                <label class="form-check-label" for="gdate3">
                                    <strong>เข้าร่วมทั้ง 2 วัน</strong> <span class="badge bg-warning text-dark ms-2">แนะนำ</span>
                                </label>
                                <div class="invalid-feedback">
                                    กรุณาเลือกวันที่สนใจเข้าร่วมงาน
                                </div>
                            </div>
                            <small class="form-text d-block mt-2 text-center">(2 วันที่จะยกระดับความเชี่ยวชาญในอาชีพของคุณ)</small>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="submit-btn fs-5">
                                <i class="bi bi-check-circle me-2"></i>สมัครลงทะเบียน
                            </button>
                        </div>
                    </form>
                </div>
            </section>
        </main>
    </div>
    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbxeQVWU7m3laqQowhev9487Ize_SAW8zy7qj-IlneYSz-DHwUBMnpb73CTnVc9ADFg/exec'
        const LIFF_ID = '1655873446-MpmBPPzl'
        var folder_token_obj, auth_users
        $(document).ready(function () {
            let page = new URLSearchParams(window.location.search).get('p');
            page = page == null ? 1 : page;
            if (page) {
                changePage(page);
            }
            $.LoadingOverlay("show");
            liff.init({
                liffId: LIFF_ID,
                withLoginOnExternalBrowser: true
            })
            liff.ready.then(() => {
                // console.log(liff.getContext());
                // if (liff.getOS() != 'android' && liff.getContext().type != 'external') {
                //     liff.openWindow({ url: liff.getContext().endpointUrl, external: true })
                //     liff.closeWindow()
                // }
                initApp();
                console.log('liff ready');

            });
            $('[name="guest-occupation"]').on('change', function () {
                let checked = $('[name="guest-occupation"]:checked').length
                if(checked == 0) {
                    $('[name="guest-occupation"]').prop('required', true)
                } else {
                    $('[name="guest-occupation"]').prop('required', false)
                }
            })
        });
        function changePage(page) {
            $('.pages').addClass('d-none');
            $('#page' + page).removeClass('d-none');
        }

        function initApp() {
            $.LoadingOverlay("hide");
        }

        function checkMemberId(){
            let id = $('#check-id').val()
            console.log("🚀 ~ checkMemberId ~ id:", id)
            if(id == '') {
                return Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: 'กรุณากรอกรหัสลูกค้า',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                })
            }
            $.LoadingOverlay("show");
            $.post(scriptUrl, {opt: 'checkMemberId', id: id}, function(res){
                console.log(res);
                $.LoadingOverlay("hide");
                if(res.status == 'not found') {
                    return Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: 'ไม่พบรหัสลูกค้า',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false
                    })
                }
                $('#id-checker').closest('.card-modern').addClass('d-none')
                $('#member-form-card').removeClass('d-none')
                $('#member-id').val(id.toUpperCase())
                $('#name').val(res.name)
                $('#province').val(res.province)
                $('#phone').val(res.phone)
                if(res.uid && res.uid != '') {
                    Swal.fire({
                        icon: 'info',
                        title: 'คุณได้ลงทะเบียนเข้าร่วมงานแล้ว',
                        html: 'ขอบคุณที่ลงทะเบียนเข้าร่วมงาน<br><br><b>THAILAND LOCKSMITH 2025</b><br><br>หากต้องการเปลี่ยนแปลงข้อมูล กรุณาติดต่อฝ่ายบริการลูกค้า',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false
                    })
                    $('[name="date"]').each(function(){
                        if($(this).val() == res['visit-date']) {
                            console.log('checked', $(this).val());
                            $(this).prop('checked', true)
                        }
                        $(this).prop('disabled', true)
                    })
                    $('#follower').val(res.follower)
                    $('#member-form input, #member-form button').prop('disabled', true)
                    $('#member-form button').text('ลงทะเบียนเรียบร้อยแล้ว')
                }
            }).fail(function(res){
                console.log(res);
                $.LoadingOverlay("hide");
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: 'กรุณาลองใหม่อีกครั้ง',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                })
            })
        }

        function submitMemberForm() {
            $.LoadingOverlay("show");
            let data = {
                member_id: $('#member-form #member-id').val(),
                name: $('#member-form #name').val(),
                province: $('#member-form #province').val(),
                phone: $('#member-form #phone').val(),
                date: $('#member-form input[name=date]:checked').val(),
                follower: $('#member-form #follower').val(),
                uid: liff.getContext().userId,
                opt: 'memberRegist'
            }
            console.log(data);
            $.post(scriptUrl, data, function (res) {
                console.log(res);
                $.LoadingOverlay("hide");
                sendMessage('member', data)
                Swal.fire({
                    icon: 'success',
                    title: 'ลงทะเบียนสำเร็จ',
                    text: 'ขอบคุณที่ลงทะเบียนเข้าร่วมงาน THAILAND LOCKSMITH 2025',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        liff.closeWindow()
                    }
                })
            }).fail(function (res) {
                console.log(res);
                $.LoadingOverlay("hide");
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: 'กรุณาลองใหม่อีกครั้ง',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                })
            })
        }

        function submitGuestForm() {
            $.LoadingOverlay("show");
            let data = {
                name: $('#guest-form #guest-name').val(),
                province: $('#guest-form #guest-province').val(),
                phone: $('#guest-form #guest-phone').val(),
                occupation: $('#guest-form input[name=guest-occupation]:checked').map(function () {
                    return this.value
                }).get().join(', '),
                interest: $('#guest-form #guest-interest').val(),
                date: $('#guest-form input[name=date]:checked').val(),
                uid: liff.getContext().userId,
                opt: 'guestRegist'
            }
            console.log(data);
            $.post(scriptUrl, data, function (res) {
                console.log(res);
                $.LoadingOverlay("hide");
                if (res.status == 'already register') {
                    return Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: 'คุณได้ลงทะเบียนเข้าร่วมงานแล้ว',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false
                    })
                }
                data.guest_id = res.guest_id
                sendMessage('guest', data)
                Swal.fire({
                    icon: 'success',
                    title: 'ลงทะเบียนสำเร็จ',
                    text: 'ขอบคุณที่ลงทะเบียนเข้าร่วมงาน THAILAND LOCKSMITH 2025',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        liff.closeWindow()
                    }
                })
            }).fail(function (res) {
                console.log(res);
                $.LoadingOverlay("hide");
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: 'กรุณาลองใหม่อีกครั้ง',
                    confirmButtonText: 'ปิด',
                    allowOutsideClick: false
                })
            })
        }

        function sendMessage(type, data) {
            let flex = {
                "type": "bubble",
                "size": "giga",
                "body": {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                            "type": "image",
                            "url": "https://img5.pic.in.th/file/secure-sv1/green-rectangle-tiled-mosaic-pattern-background-vector-16316718.png",
                            "size": "full",
                            "position": "absolute",
                            "aspectMode": "cover",
                            "margin": "none",
                            "aspectRatio": "1:1.5"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "horizontal",
                                    "flex": 1,
                                    "width": "350px",
                                    "contents": [
                                        {
                                            "type": "box",
                                            "layout": "vertical",
                                            "contents": [
                                                {
                                                    "type": "text",
                                                    "text": "WWW.POLLERT.COM",
                                                    "color": "#eac284",
                                                    "size": "xxs",
                                                    "align": "start"
                                                },
                                                {
                                                    "type": "text",
                                                    "text": "THAILAND LOCKSMITH 2025",
                                                    "color": "#FFFFFF",
                                                    "size": "lg",
                                                    "align": "start",
                                                    "weight": "bold",
                                                    "scaling": true,
                                                    "adjustMode": "shrink-to-fit"
                                                }
                                            ],
                                            "flex": 9,
                                            "spacing": "md"
                                        },
                                        {
                                            "type": "box",
                                            "layout": "vertical",
                                            "contents": [
                                                {
                                                    "type": "image",
                                                    "url": "https://img2.pic.in.th/pic/1730737040513.png",
                                                    "aspectMode": "fit",
                                                    "position": "relative",
                                                    "size": "xs",
                                                    "offsetTop": "-10px"
                                                }
                                            ],
                                            "flex": 2,
                                            "alignItems": "flex-end",
                                            "justifyContent": "flex-start",
                                            "offsetTop": "none",
                                            "paddingTop": "none"
                                        }
                                    ]
                                },
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": type == 'member' ? data.member_id : data.guest_id,
                                            "align": "center",
                                            "size": "xl",
                                            "weight": "bold",
                                            "gravity": "center",
                                            "color": "#000000",
                                            "scaling": true,
                                            "adjustMode": "shrink-to-fit"
                                        }
                                    ],
                                    "width": "230px",
                                    "backgroundColor": "#eac285",
                                    "cornerRadius": "md",
                                    "justifyContent": "center",
                                    "alignItems": "center"
                                },
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": data.name,
                                            "weight": "bold",
                                            "size": "xl",
                                            "color": "#eac285",
                                            "align": "center",
                                            "adjustMode": "shrink-to-fit",
                                            "scaling": true
                                        }
                                    ]
                                },
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "บัตรเข้างานวันที่ 14-15 ธันวาคม 2567 โปรดแสดงบัตรนี้พร้อมบัตรประชาชนก่อนเข้างาน",
                                            "color": "#FFD700",
                                            "size": "sm",
                                            "align": "center",
                                            "wrap": true
                                        },
                                        {
                                            "type": "image",
                                            "url": "https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=" + encodeURIComponent(type == 'member' ? data.member_id : data.guest_id),
                                            "size": "sm",
                                            "aspectMode": "cover",
                                            "margin": "lg"
                                        },
                                        {
                                            "type": "text",
                                            "text": "SCAN QR-CODE",
                                            "color": "#eac285",
                                            "size": "xs",
                                            "align": "center",
                                            "margin": "md"
                                        }
                                    ],
                                    "paddingAll": "lg"
                                }
                            ],
                            "paddingAll": "md",
                            "justifyContent": "center",
                            "alignItems": "center",
                            "spacing": "md",
                            "backgroundColor": "#00000066"
                        }
                    ],
                    "backgroundColor": "#004225",
                    "justifyContent": "center",
                    "alignItems": "center",
                    "paddingAll": "none"
                },
                "styles": {
                    "body": {
                        "backgroundColor": "#004225"
                    },
                    "footer": {
                        "backgroundColor": "#004225"
                    }
                }
            }

            if (data.follower && data.follower != '') {
                flex.body.contents[1].contents[2].contents.push(
                    {
                        "type": "text",
                        "text": "&",
                        "weight": "bold",
                        "size": "xl",
                        "color": "#eac285",
                        "align": "center"
                    }, {
                    "type": "text",
                    "text": data.follower,
                    "weight": "bold",
                    "size": "xl",
                    "color": "#eac285",
                    "align": "center",
                    "scaling": true,
                    "adjustMode": "shrink-to-fit"
                })
            }
            console.log(JSON.stringify(flex));
            liff.sendMessages([{
                "type": "flex",
                "altText": "ลงทะเบียนสำเร็จ",
                "contents": flex
            }]).then(() => {
                console.log('message sent');
            }).catch((err) => {
                console.log(err);
            })
        }
    </script>
    <script>
        (function () {
            'use strict'
            var forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms)
                .forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        event.preventDefault()
                        if (!form.checkValidity()) {
                            event.stopPropagation()
                            form.classList.add('was-validated')
                            $(form).find(':invalid').first().focus()
                        } else {
                            if (form.id == 'id-checker') return checkMemberId()
                            if (form.id == 'member-form') return submitMemberForm()
                            if (form.id == 'guest-form') return submitGuestForm()
                        }
                    }, false)
                })
        })()
    </script>
    <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
    <script>
        // VConsole will be exported to `window.VConsole` by default.
        var vConsole = new window.VConsole();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"
        integrity="sha512-pumBsjNRGGqkPzKHndZMaAG+bir374sORyzM3uulLV14lN5LyykqNk8eEeUlUkB3U0M4FApyaHraT65ihJhDpQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Default background style */
        body {
            background-color: #e4c9e5;
            position: relative;
            width: 100%;
            height: 100vh;
            font-family: 'Prompt', sans-serif;
        }

        .wrapper {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        main,
        header {
            position: absolute;
            width: 100%;
            height: 100vh;
            top: 0;
            left: 0;
            overflow-x: hidden;
        }

        .form-wrapper {
            width: 100%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 10px;
        }

        /* Circle balloon */
        .balloon-top {
            position: absolute;
            top: 90px;
            left: -70px;
            width: 240px;
            height: 250px;
            background-color: #feb06a;
            border-radius: 50%;
            border: 2px solid #feb06a;
            text-align: center;
            line-height: 50px;
            font-size: 24px;
            font-weight: bold;
        }

        .balloon-bottom {
            position: absolute;
            bottom: -40px;
            right: -40px;
            width: 240px;
            height: 250px;
            background-color: #36d6e7;
            border-radius: 50%;
            border: 2px solid #36d6e7;
            text-align: center;
            line-height: 50px;
            font-size: 24px;
            font-weight: bold;
            overflow-y: hidden;
        }

        @media screen and (max-width: 576px) {
            .card {
                width: 100%;
            }
        }

        /* Background style for screens between 576px and 991.98px */
        @media (min-width: 576px) and (max-width: 991.98px) {
            .balloon-top {
                top: 70px;
                left: 100px;
            }

            .balloon-bottom {
                bottom: -40px;
                right: 100px;
            }

            .card {
                width: 100%;
                max-width: 500px;
            }
        }

        /* Background style for screens larger than 992px */
        @media (min-width: 992px) {
            .balloon-top {
                top: 100px;
                left: 100px;
            }

            .balloon-bottom {
                bottom: 40px;
                right: 100px;
            }

            .card {
                width: 100%;
                max-width: 600px;
            }
        }

        /* .form-control {
            background-color: #d4d3d3;
        }

        .form-check-input {
            background-color: #d4d3d3;
        }

        .form-select {
            background-color: #d4d3d3;
        } */

        .submit-btn {
            background-color: #7ed957;
            color: #fff;
        }

        .submit-btn:hover {
            background-color: #6ecf4a;
            color: #fff;
        }

        .glassmophism {
            background: rgba(255, 255, 255, 0.75);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="balloon-top"></div>
        <div class="balloon-bottom"></div>
    </div>
    <main class="container-fluid">
        <div class="row g-2 justify-content-center">
            <div class="col-12 text-center">
                <div class="display-3 fw-bold mt-3">ลงทะเบียนเข้างาน</div>
            </div>
            <div class="col-12 text-center">
                <div>THAILAND LOCKSMITHS 2023</div>
            </div>
            <div class="col-12 mt-3">
                <div class="container-fluid d-flex justify-content-center">
                    <div class="card py-4 mx-3 mb-5 glassmophism">
                        <div class="card-body">
                            <div class="alert alert-warning show shadow" role="alert">
                                กรุณากรอกเลขบัตรประจำตัวประชาชน 13 หลัก เพื่อตรวจสอบสิทธิ์การเข้างาน
                            </div>
                            <form id="authen-form" class="row g-3 justify-content-center needs-validation" novalidate>
                                <div class="col-12">
                                    <label for="id_card">รหัสบัตรประจำตัวประชาชน</label>
                                    <input type="text" class="form-control text-center" id="id_card" name="id_card"
                                        required>
                                    <div class="invalid-feedback">
                                        กรุณากรอกเลขบัตรประจำตัวประชาชน 13 หลัก
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 col-lg-4 text-center">
                                    <button type="submit" class="btn w-100 submit-btn">ตรวจสอบ</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 mt-3 d-none">
                <div class="container-fluid d-flex justify-content-center">
                    <div class="card py-4 mx-3 mb-5 glassmophism">
                        <div class="card-body">
                            <form id="register-form" class="row g-3 justify-content-center needs-validation" novalidate>
                                <div class="col-12">
                                    <label for="customer-id">รหัสลูกค้า</label>
                                    <input type="text" class="form-control" id="customer-id" name="customer-id">
                                </div>
                                <div class="col-12">
                                    <label for="name">ชื่อ-นามสกุล</label>
                                    <input type="text" class="form-control" id="name" name="name">
                                </div>
                                <!-- จังหวัด -->
                                <div class="col-12">
                                    <label for="province">จังหวัด</label>
                                    <input type="text" class="form-control" id="province" name="province">
                                </div>
                                <!-- เบอร์โทร -->
                                <div class="col-12">
                                    <label for="phone">เบอร์โทร</label>
                                    <input type="text" class="form-control" id="phone" name="phone">
                                </div>
                                <div class="col-12">
                                    <div class="alert alert-warning show shadow" role="alert">
                                        กรุณากรอกข้อมูลเพิ่มเติม เพื่อลงทะเบียนเข้างาน
                                    </div>
                                </div>
                                <!-- เข้าร่วมงานวันที่ -->
                                <div class="col-12">
                                    <label for="date">เข้าร่วมงานวันที่</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="2023-12-2"
                                            id="date-visit-1" name="date-visit-1" required>
                                        <label class="form-check-label" for="date-visit-1">
                                            <span class="fw-bold">วันเสาร์</span> ที่ 2 ธันวาคม 2566
                                        </label>
                                    </div>
                                    <div class="form-check mt-2">
                                        <input class="form-check-input" type="checkbox" value="2023-12-3"
                                            id="date-visit-2" name="date-visit-2" required>
                                        <label class="form-check-label" for="date-visit-2">
                                            <span class="fw-bold">วันอาทิตย์</span> ที่ 3 ธันวาคม 2566
                                        </label>
                                        <div class="invalid-feedback">
                                            กรุณาเลือกวันที่เข้างาน
                                        </div>
                                    </div>
                                </div>
                                <!-- รับประทานอาหารกลางวัน -->
                                <div class="col-12">
                                    <label for="launch">รับประทานอาหารกลางวัน</label>
                                    <select class="form-select" id="launch" name="launch" required>
                                        <option value="" selected>เลือกประเภทอาหาร</option>
                                        <option value="มังสวิรัติ">มังสวิรัติ</option>
                                        <option value="ไม่ทานเนื้อ">ไม่ทานเนื้อ</option>
                                        <option value="ไม่ทานหมู">ไม่ทานหมู</option>
                                        <option value="ทานได้หมด">ทานได้หมด</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        กรุณาเลือกประเภทอาหาร
                                    </div>
                                </div>
                                <!-- ถ่ายรูปหน้าตรง ไม่สวมแว่นตา -->
                                <div class="col-12">
                                    <label for="photo">ถ่ายรูปหน้าตรง ไม่สวมแว่นตา</label>
                                    <input class="form-control" type="file" id="photo" name="photo" capture="user"
                                        accept="image/*" required>
                                    <div class="invalid-feedback">
                                        กรุณาถ่ายรูปหน้าตรง ไม่สวมแว่นตา
                                    </div>
                                    <div class="d-flex w-100 justify-content-center" style="display: none;">
                                        <img src="https://img.icons8.com/fluency/96/image--v1.png" alt="preview"
                                            class="img-fluid mt-2 rounded shadow" id="preview"
                                            style="max-width: 300px; max-height: 400px;">
                                    </div>
                                </div>
                                <div class="col-12 col-md-6 col-lg-4">
                                    <button type="submit" class="btn w-100 submit-btn"
                                        id="submit-btn">ลงทะเบียน</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbxM-DWZcssBPCsGwVXI5-dhqLanwur0JifVPJYaMh_ZFEYSOOhbkwnwor65rIHGWBB3/exec'
        const LIFF_ID = '1655873446-MpmBPPzl'
        var folder_token_obj
        $(document).ready(() => {
            $.LoadingOverlay("show");
            liff.init({
                liffId: LIFF_ID,
                withLoginOnExternalBrowser: true
            })
            liff.ready.then(() => {
                $.LoadingOverlay("hide");
                initApp();
                userValidate(true)
                $.post(scriptUrl, { opt: 'getdownload_token' }, function (res) {
                    folder_token_obj = res
                    console.log("🚀 !! folder_token_obj:", folder_token_obj)
                })
            });
        })

        function initApp() {
            $('#photo').change(function () {
                var file = $(this)[0].files[0];
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#preview').attr('src', e.target.result);
                    $('#preview').parent().show();
                }
                reader.readAsDataURL(file);
            })
            $('input[type="checkbox"]').each(function () {
                $('label[for="' + $(this).attr('id') + '"]').click(function () {
                    $(this).toggleClass('text-success');
                })
                $(this).change(function () {
                    if ($(this).is(':checked')) {
                        $('label[for="' + $(this).attr('id') + '"]').addClass('text-success');
                        $('input[type="checkbox"]').removeAttr('required')
                    }
                    else {
                        $('label[for="' + $(this).attr('id') + '"]').removeClass('text-success');
                        if ($('input[type="checkbox"]:checked').length == 0) $('input[type="checkbox"]').attr('required', true)
                    }
                })
            })
        }

        function setData(data) {
            Object.keys(data).forEach(key => {
                if (key == 'visit-date' && data[key] != '') {
                    let parent = $('input[type="checkbox"]').closest('.col-12')
                    $('input[type="checkbox"]').parents('.form-check').remove()
                    parent.append(`<input type="text" class="form-control" id="${key}" name="${key}" value="${data[key]}" readonly>`)
                } else if (key == 'launch' && data[key] != '') {
                    $(`#${key}`).replaceWith(`<input type="text" class="form-control" id="${key}" name="${key}" value="${data[key]}" readonly>`)
                }
                else if (key == 'image' && data[key] != '') {
                    $('#preview').attr('src', data[key])
                    $('#preview').parent().show();
                    $('#photo').hide()
                }
                else $(`#${key}`).val(data[key])
                if (data[key] != '') $(`#${key}`).addClass('bg-primary-subtle').attr('readonly', true)
            })
            if (Object.values(data).every(v => v != '')) {
                $('#submit-btn').attr('disabled', true).text('ลงทะเบียนเรียบร้อยแล้ว').parent().removeClass('col-md-6 col-lg-4')
                $('#register-form').find('.alert').parent().remove()
            }
        }

        function userValidate(isInit = false) {
            Swal.fire({
                icon: 'info',
                title: isInit ? 'กำลังโหลดข้อมูล' : 'กำลังตรวจสอบสิทธิ์การเข้างาน',
                text: 'กรุณารอสักครู่',
                showConfirmButton: false,
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading()
                }
            })
            let id_card = $('#id_card').val();
            $.post(scriptUrl, { opt: 'authen', id_card: id_card, uid: liff.getDecodedIDToken().sub }, (res) => {
                console.log("🚀 !! res:", res)
                if (res.status == 'success') {
                    Swal.update({
                        icon: 'success',
                        title: 'คุณได้รับสิทธิ์เข้างาน',
                        showConfirmButton: false,
                    })
                    setData(res.data);
                    setTimeout(() => {
                        Swal.close();
                        $('#authen-form').parents('.col-12').addClass('d-none');
                        $('#register-form').parents('.col-12').removeClass('d-none');
                    }, 2000)
                } else if (res.status == 'validated') {
                    Swal.update({
                        icon: 'success',
                        title: 'คุณได้ยืนยันตัวตนเรียบร้อยแล้ว',
                        text: 'คุณมีสิทธิ์เข้างาน',
                        showConfirmButton: false,
                    })
                    setData(res.data);
                    setTimeout(() => {
                        Swal.close();
                        $('#authen-form').parents('.col-12').addClass('d-none');
                        $('#register-form').parents('.col-12').removeClass('d-none');
                    }, 2000)
                } else if (res.status == 'not validated') {
                    Swal.close()
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ท่านไม่มีสิทธิ์ลงทะเบียน',
                        html: 'กรุณาติดต่อแอดมิน <br><a href="tel:0891109020">089-110-9020</a> <br><a href="tel:028681990">02-868-1990</a>',
                        showConfirmButton: false,
                        allowOutsideClick: false,
                    })
                }
            })
        }

        async function userRegister() {
            uploadFile();
        }

        async function uploadFile() {
            console.log('uploading');
            const file = document.getElementById("photo").files[0];
            Swal.fire({
                icon: 'info',
                title: 'กำลังอัปโหลดรูปภาพ',
                html: `
                <div class="container-fluid d-flex flex-column justify-content-center gap-2">
                    <div class="h1"><img src="./upload-icon.gif" width="70px" height='auto'>&nbsp;<span id="progress">0%</span></div>
                    <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="1" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar bg-info" style="width: 1%"></div>
                    </div>
                </div>`,
                showConfirmButton: false,
                allowOutsideClick: false,
            })
            console.log('compress file, initial size:', file.size);
            return await new Compressor(file, {
                quality: 0.6,
                success(result) {
                    console.log("🚀 !! result:", result)
                    console.log('compress file, final size:', result.size);
                    const metadata = {
                        name: $('#customer-id').val() + ' ' + $('#name').val() + result.type.replace('image/', '.'),
                    };
                    let file = new File([result], metadata.name, { type: result.type });
                    return gdriveUpload({
                        ...folder_token_obj,
                        file,
                        metadata,
                        chunkSize: 0.25 * 1024 * 1024,
                        onProgress: function (value) {
                            if (value === undefined) return;
                            else if (value == 1) {
                                Swal.update({
                                    icon: 'info',
                                    title: 'กำลังบันทึกข้อมูล',
                                    showConfirmButton: false,
                                    allowOutsideClick: false,
                                })
                            }
                            const percent = Math.floor(100 * value);
                            console.log(`progress: ${percent}%`);
                            $('#progress').text(`${percent}%`);
                            $('.progress-bar').css('width', `${percent}%`);
                            $('.progress').attr('aria-valuenow', `${percent}`);
                        },
                    }).then((res) => {
                        saveData(res)
                    })
                },
                error(err) {
                    console.log(err.message);
                },
            });
        }

        function saveData(file) {
            console.log("🚀 !! file:", file)
            let image = 'https://lh3.googleusercontent.com/d/' + file.id
            let data_visit = $('input[type="checkbox"]:checked').map(function () {
                return $('label[for="' + $(this).attr('id') + '"]').text().trim()
            }).get().join(' และ ') || ''
            let data = {
                opt: 'regist',
                image: image,
                uid: liff.getDecodedIDToken().sub,
                ['visit-date']: data_visit,
                launch: $('#launch').val(),
            }
            $.post(scriptUrl, data, function (result) {
                if (result.status == 'success') {
                    liff.sendMessages([
                        getFlexMessage(data),
                        {
                            type: 'text',
                            text: 'กรุณาแสดงบัตรประจำตัวผู้เข้างานกับเจ้าหน้าที่ก่อนเข้างาน'
                        }
                    ])
                    Swal.fire({
                        icon: 'success',
                        title: 'ลงทะเบียนเรียบร้อย',
                        text: 'ขอบคุณที่ให้ความร่วมมือ',
                        confirmButtonText: 'ปิด',
                        allowOutsideClick: false,
                    }).then(() => {
                        liff.closeWindow();
                    })
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'ไม่สำเร็จ',
                        text: 'กรุณาลองใหม่อีกครั้ง',
                        showConfirmButton: false,
                        allowOutsideClick: false,
                    })
                }
            })

        }

        function getFlexMessage(data) {
            let flex = {
                "type": "bubble",
                "body": {
                    "type": "box",
                    "layout": "vertical",
                    "contents": [
                        {
                            "type": "image",
                            "url": "https://cdn.pic.in.th/file/picinth/Futuristic-Red-Black-Background-Design-Graphics-30694681-1.jpeg",
                            "gravity": "top",
                            "size": "full",
                            "aspectMode": "cover",
                            "aspectRatio": "1:2"
                        },
                        {
                            "type": "box",
                            "layout": "horizontal",
                            "contents": [
                                {
                                    "type": "image",
                                    "url": "https://cdn.pic.in.th/file/picinth/LOGOpng.png",
                                    "flex": 1,
                                    "aspectRatio": "4:3",
                                    "aspectMode": "cover",
                                    "size": "40px",
                                    "align": "end"
                                },
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": "THAILAND LOCKSMITH 2023",
                                            "weight": "bold",
                                            "size": "lg",
                                            "adjustMode": "shrink-to-fit",
                                            "color": "#ffffff"
                                        }
                                    ],
                                    "flex": 7
                                }
                            ],
                            "alignItems": "center",
                            "justifyContent": "space-evenly",
                            "spacing": "sm",
                            "position": "absolute",
                            "paddingAll": "18px"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "image",
                                            "url": data['image'],
                                            "size": "full",
                                            "aspectMode": "cover",
                                            "action": {
                                                "type": "uri",
                                                "label": "action",
                                                "uri": data['image']
                                            }
                                        }
                                    ],
                                    "cornerRadius": "500px",
                                    "justifyContent": "center",
                                    "borderWidth": "10px",
                                    "borderColor": "#cb2525",
                                    "width": "220px"
                                },
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "text",
                                            "text": $('#name').val(),
                                            "color": "#fcc814",
                                            "size": "xxl",
                                            "adjustMode": "shrink-to-fit",
                                            "align": "center",
                                            "weight": "bold"
                                        },
                                        {
                                            "type": "text",
                                            "text": $('#province').val(),
                                            "color": "#777777",
                                            "size": "lg",
                                            "adjustMode": "shrink-to-fit",
                                            "align": "center"
                                        }
                                    ]
                                }
                            ],
                            "offsetTop": "0px",
                            "offsetEnd": "0px",
                            "offsetBottom": "0px",
                            "position": "absolute",
                            "justifyContent": "flex-start",
                            "alignItems": "center",
                            "paddingTop": "60px",
                            "offsetStart": "0px"
                        },
                        {
                            "type": "box",
                            "layout": "vertical",
                            "contents": [
                                {
                                    "type": "box",
                                    "layout": "vertical",
                                    "contents": [
                                        {
                                            "type": "image",
                                            "url": "https://chart.googleapis.com/chart?cht=qr&chs=120x120&chl=" + $('#customer-id').val(),
                                            "size": "full",
                                            "align": "center",
                                            "aspectMode": "cover"
                                        }
                                    ],
                                    "width": "100px",
                                    "borderWidth": "light",
                                    "borderColor": "#777777"
                                },
                                {
                                    "type": "text",
                                    "text": $('#customer-id').val(),
                                    "color": "#ffffff",
                                    "weight": "bold"
                                }
                            ],
                            "cornerRadius": "lg",
                            "offsetBottom": "0px",
                            "offsetStart": "0px",
                            "position": "absolute",
                            "paddingAll": "lg",
                            "justifyContent": "center",
                            "alignItems": "center",
                            "offsetEnd": "0px"
                        }
                    ],
                    "paddingAll": "0px",
                    "height": "500px"
                },
                "styles": {
                    "footer": {
                        "backgroundColor": "#000000"
                    }
                }
            }
            console.log("🚀 !! flex:", flex);
            return {
                "type": "flex",
                "altText": "บัตรประจำตัวผู้เข้างาน",
                "contents": flex
            }
        }
    </script>
    <script>
        // form validation
        (() => {
            'use strict'

            // Fetch all the forms we want to apply custom Bootstrap validation styles to
            const forms = document.querySelectorAll('.needs-validation')

            // Loop over them and prevent submission
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    event.preventDefault()
                    if (!form.checkValidity()) {
                        event.stopPropagation()
                        form.classList.add('was-validated')
                        $(form).find(":invalid").first().focus();
                    } else {
                        if ($(form).attr('id') == 'authen-form') {
                            userValidate();
                        } else if ($(form).attr('id') == 'register-form') {
                            userRegister();
                        }
                    }

                })
            })
        })()
    </script>
    <script>
        async function gdriveUpload(opt) {
            if (!(opt.file && opt.token)) throw new TypeError("bad param");
            if (!opt.file.size) return new Error("empty file");
            let res
            try {
                const location = await getUploadLocation();
                if (location instanceof Error) return location;
                res = await uploadChunks(location);
                if (res instanceof Error) return res;
                return res;
            } catch (error) {
                if (error instanceof Error) return error;
                throw error;
            }
            async function getUploadLocation() {
                let metadata = { mimeType: opt.file.type, name: opt.file.name };
                if (opt.folder) metadata.parents = [opt.folder];
                if (opt.metadata) metadata = { ...metadata, ...opt.metadata };
                try {
                    const response = await fetch(
                        "https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable",
                        {
                            method: "POST", cache: "no-cache",
                            headers: {
                                Authorization: "Bearer " + opt.token,
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(metadata)
                        });
                    if (!response.ok) return new Error(`create: ${response.status} ${response.statusText}`);
                    const location = response.headers.get("location");
                    if (!location) return new Error("no location");
                    return location;
                } catch (error) {
                    if (error instanceof Error) return error;
                    throw error;
                }
            }
            async function uploadChunks(location) {
                const onProgress = opt.onProgress || ((_v) => { });
                const chunkSize = opt.chunkSize || _DEFAULT.chunkSize;
                if (chunkSize <= 0 || chunkSize % (256 * 1024))
                    throw TypeError("bad chunkSize: " + chunkSize);
                const size = opt.file.size;
                try {
                    for (let end = NaN, start = 0; ; start = end + 1) {
                        onProgress(start / size); // signal progress
                        end = Math.min(start + chunkSize, size);
                        const blob = await opt.file.slice(start, end).arrayBuffer(); // read from file
                        const response = await fetch(location, // upload the chunk to location
                            {
                                method: "PUT", cache: "no-cache", body: blob,
                                headers: { "Content-Range": `bytes ${start}-${end - 1}/${size}` }
                            });
                        if (response.ok) { // all done
                            onProgress(1); // signal 100% progress
                            return response.json(); // success
                        }
                        if (response.status != 308) return new Error(`upload: ${response.status} ${response.statusText}`);
                        const r = response.headers.get("Range");
                        if (!r) return new Error("no Range");
                        end = parseInt(r.substr(r.indexOf("-") + 1)); // get where the real upload end
                        if (!Number.isInteger(end) || end <= start) return new Error("bad range: " + r);
                    }
                } catch (error) {
                    if (error instanceof Error) return error;
                    throw error;
                }
            }
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
</body>

</html>